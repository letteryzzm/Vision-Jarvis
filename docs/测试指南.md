# äº‹é¡¹é©±åŠ¨è®°å¿†ç³»ç»Ÿ - æµ‹è¯•æŒ‡å—

## ğŸ“‹ ç›®å½•
1. [å¿«é€ŸéªŒè¯](#å¿«é€ŸéªŒè¯)
2. [åˆ†é˜¶æ®µæµ‹è¯•](#åˆ†é˜¶æ®µæµ‹è¯•)
3. [æ‰‹åŠ¨ç«¯åˆ°ç«¯æµ‹è¯•](#æ‰‹åŠ¨ç«¯åˆ°ç«¯æµ‹è¯•)
4. [æµ‹è¯•æ•°æ®ç”Ÿæˆ](#æµ‹è¯•æ•°æ®ç”Ÿæˆ)
5. [é¢„æœŸç»“æœ](#é¢„æœŸç»“æœ)

---

## ğŸš€ å¿«é€ŸéªŒè¯

### è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•
```bash
cd vision-jarvis/src-tauri
cargo test --lib
```

**é¢„æœŸè¾“å‡º**:
```
test result: ok. 121 passed; 0 failed; 3 ignored
```

---

## ğŸ” åˆ†é˜¶æ®µæµ‹è¯•

### Phase 1: æ•°æ®åº“åŸºç¡€
```bash
# æµ‹è¯•æ•°æ®åº“è¿ç§»
cargo test --lib db::migrations -- --nocapture

# åº”çœ‹åˆ°5ä¸ªæµ‹è¯•é€šè¿‡:
# - test_fresh_install_v2 (å…¨æ–°å®‰è£…V2)
# - test_v1_to_v2_upgrade (V1å‡çº§åˆ°V2)
# - test_idempotent_migrations (å¹‚ç­‰æ€§)
# - test_activities_table_structure (è¡¨ç»“æ„)
# - test_memory_chunks_foreign_key (å¤–é”®çº¦æŸ)
```

### Phase 2: æ´»åŠ¨åˆ†ç»„
```bash
# æµ‹è¯•åˆ†ç»„ç®—æ³•
cargo test --lib memory::activity_grouper -- --nocapture

# 6ä¸ªæµ‹è¯•ç”¨ä¾‹:
# âœ… test_single_group - è¿ç»­æˆªå›¾åˆå¹¶
# âœ… test_app_change_splits_group - åº”ç”¨åˆ‡æ¢æ‹†åˆ†
# âœ… test_time_gap_splits_group - æ—¶é—´é—´éš”æ‹†åˆ†
# âœ… test_min_screenshots_filter - æœ€å°æˆªå›¾æ•°è¿‡æ»¤
# âœ… test_max_duration_splits - æœ€å¤§æ—¶é•¿æ‹†åˆ†
# âœ… test_activities_are_related - æ´»åŠ¨ç›¸å…³æ€§åˆ¤æ–­
```

### Phase 3: Markdownç”Ÿæˆ
```bash
# æµ‹è¯•Markdownç”Ÿæˆ
cargo test --lib memory::markdown_generator -- --nocapture

# 9ä¸ªæµ‹è¯•ç”¨ä¾‹:
# âœ… Frontmatteræ„å»º
# âœ… æ¨¡æ¿æ€»ç»“ç”Ÿæˆ
# âœ… æˆªå›¾æ—¶é—´çº¿ç”Ÿæˆ
# âœ… æ–‡ä»¶å†™å…¥
# âœ… æ—¶é—´æˆ³æ ¼å¼åŒ–
# âœ… Markdownç»„è£…
```

### Phase 4: ç´¢å¼•ä¸æœç´¢
```bash
# æµ‹è¯•æ–‡æœ¬åˆ†å—
cargo test --lib memory::chunker -- --nocapture

# æµ‹è¯•æ··åˆæœç´¢
cargo test --lib memory::hybrid_search -- --nocapture

# å…³é”®æµ‹è¯•:
# âœ… CJK tokenä¼°ç®—
# âœ… Frontmatterè·³è¿‡
# âœ… Cosineç›¸ä¼¼åº¦è®¡ç®—
# âœ… å…³é”®è¯åŒ¹é…å¾—åˆ†
```

### Phase 5: ç®¡é“è°ƒåº¦
```bash
cargo test --lib memory::pipeline -- --nocapture

# 2ä¸ªæµ‹è¯•:
# âœ… ç©ºæ•°æ®åº“æŸ¥è¯¢
# âœ… é™åˆ¶è¿”å›æ•°é‡
```

---

## ğŸ§ª æ‰‹åŠ¨ç«¯åˆ°ç«¯æµ‹è¯•

ç”±äºé›†æˆæµ‹è¯•éœ€è¦æ¨¡å—å…¬å¼€,è¿™é‡Œæä¾›**æ‰‹åŠ¨æµ‹è¯•æµç¨‹**:

### æ­¥éª¤1: å‡†å¤‡æµ‹è¯•æ•°æ®åº“

ä½¿ç”¨Rustæµ‹è¯•ä»£ç åˆ›å»ºæµ‹è¯•æ•°æ®:

```bash
# åœ¨vision-jarvis/src-tauriç›®å½•ä¸‹æ‰§è¡Œ
cargo test --lib memory::activity_grouper::tests::test_single_group -- --exact --nocapture
```

è¿™ä¼šè‡ªåŠ¨åˆ›å»ºå†…å­˜æ•°æ®åº“å¹¶æ’å…¥æµ‹è¯•æ•°æ®ã€‚

### æ­¥éª¤2: éªŒè¯æ•°æ®åº“ç»“æ„

```bash
# è¿è¡Œæ•°æ®åº“è¿ç§»æµ‹è¯•
cargo test --lib db::migrations::tests::test_fresh_install_v2 -- --exact --nocapture
```

æ£€æŸ¥è¾“å‡ºä¸­æ˜¯å¦åŒ…å«æ‰€æœ‰è¡¨:
- âœ… screenshots
- âœ… activities
- âœ… memory_files
- âœ… memory_chunks
- âœ… embedding_cache

### æ­¥éª¤3: æµ‹è¯•æ´»åŠ¨åˆ†ç»„æµç¨‹

åˆ›å»ºä¸´æ—¶æµ‹è¯•æ–‡ä»¶ `test_flow.rs` åœ¨ `src/memory/` ç›®å½•:

```rust
#[cfg(test)]
mod flow_test {
    use super::*;
    use crate::db::Database;
    use std::sync::Arc;

    #[test]
    fn test_complete_flow() {
        // 1. åˆ›å»ºæ•°æ®åº“
        let db = Arc::new(Database::open_in_memory().unwrap());

        // 2. æ’å…¥æµ‹è¯•æˆªå›¾
        insert_test_data(&db);

        // 3. æ‰§è¡Œåˆ†ç»„
        let grouper = ActivityGrouper::new(Arc::clone(&db), GroupingConfig::default());
        let screenshots = grouper.get_ungrouped_screenshots().unwrap();
        let activities = grouper.group_screenshots(&screenshots).unwrap();

        // 4. éªŒè¯ç»“æœ
        assert!(!activities.is_empty());
        println!("âœ… ç”Ÿæˆäº† {} ä¸ªæ´»åŠ¨", activities.len());
    }

    fn insert_test_data(db: &Database) {
        // æ’å…¥å·²åˆ†æçš„æˆªå›¾...
    }
}
```

---

## ğŸ“Š æµ‹è¯•æ•°æ®ç”Ÿæˆ

### å¿«é€Ÿç”Ÿæˆæµ‹è¯•æˆªå›¾æ•°æ®

åœ¨æ•°æ®åº“ä¸­æ’å…¥æ¨¡æ‹Ÿçš„å·²åˆ†ææˆªå›¾:

```sql
-- åœºæ™¯1: åŒä¸€åº”ç”¨è¿ç»­æ´»åŠ¨(åº”åˆå¹¶)
INSERT INTO screenshots (id, path, captured_at, analyzed, analysis_result, analyzed_at)
VALUES
('s1', '/test/s1.png', 1706697600, 1, '{"activity":"ç¼–å†™ä»£ç ","application":"VSCode","description":"ç¼–å†™Rustå‡½æ•°","category":"work"}', 1706697600),
('s2', '/test/s2.png', 1706697660, 1, '{"activity":"ç¼–å†™ä»£ç ","application":"VSCode","description":"ç¼–å†™Rustå‡½æ•°","category":"work"}', 1706697660),
('s3', '/test/s3.png', 1706697720, 1, '{"activity":"ç¼–å†™ä»£ç ","application":"VSCode","description":"ç¼–å†™Rustå‡½æ•°","category":"work"}', 1706697720);

-- åœºæ™¯2: åº”ç”¨åˆ‡æ¢(åº”æ‹†åˆ†)
INSERT INTO screenshots (id, path, captured_at, analyzed, analysis_result, analyzed_at)
VALUES
('s4', '/test/s4.png', 1706697780, 1, '{"activity":"æµè§ˆç½‘é¡µ","application":"Chrome","description":"æŸ¥çœ‹æ–‡æ¡£","category":"other"}', 1706697780),
('s5', '/test/s5.png', 1706697840, 1, '{"activity":"æµè§ˆç½‘é¡µ","application":"Chrome","description":"æŸ¥çœ‹æ–‡æ¡£","category":"other"}', 1706697840);
```

---

## âœ… é¢„æœŸç»“æœ

### æˆåŠŸçš„æµ‹è¯•åº”è¯¥æ˜¾ç¤º:

#### 1. æ•°æ®åº“å±‚ (Phase 1)
```
âœ… æ‰€æœ‰è¡¨å·²åˆ›å»º
âœ… å¤–é”®çº¦æŸæ­£å¸¸
âœ… V1â†’V2å‡çº§æ— æ•°æ®ä¸¢å¤±
```

#### 2. æ´»åŠ¨åˆ†ç»„ (Phase 2)
```
è¾“å…¥: 6å¼ æˆªå›¾
  - s1-s3: VSCode, ç¼–å†™ä»£ç  (è¿ç»­)
  - s4-s5: Chrome, æµè§ˆç½‘é¡µ (åº”ç”¨åˆ‡æ¢)

è¾“å‡º: 2ä¸ªæ´»åŠ¨
  - Activity 1: VSCodeä¸­ç¼–å†™ä»£ç  (3å¼ æˆªå›¾, 2åˆ†é’Ÿ)
  - Activity 2: Chromeä¸­æµè§ˆç½‘é¡µ (2å¼ æˆªå›¾, 1åˆ†é’Ÿ)
```

#### 3. Markdownç”Ÿæˆ (Phase 3)
```
ç”Ÿæˆæ–‡ä»¶ç¤ºä¾‹:
memory/activities/2024-01-15/activity-001.md

åŒ…å«:
  âœ… YAML frontmatter (å…ƒæ•°æ®)
  âœ… æ´»åŠ¨æ ‡é¢˜
  âœ… æ´»åŠ¨æ€»ç»“
  âœ… æˆªå›¾æ—¶é—´çº¿
```

#### 4. ç´¢å¼•æœç´¢ (Phase 4)
```
æ–‡æœ¬åˆ†å—:
  - è·³è¿‡frontmatter âœ…
  - CJKå­—ç¬¦ä¼°ç®—å‡†ç¡® âœ…
  - Overlapæ­£ç¡® âœ…

æ··åˆæœç´¢:
  - Vectorç›¸ä¼¼åº¦: 0.0-1.0 âœ…
  - KeywordåŒ¹é…: å‡ºç°æ¬¡æ•°è®¡åˆ† âœ…
  - åŠ æƒåˆå¹¶: 70%+30% âœ…
```

---

## ğŸ¯ æœ€ç®€å•çš„éªŒè¯æ–¹æ³•

**ä¸€é”®è¿è¡Œå…¨éƒ¨æµ‹è¯•å¹¶æŸ¥çœ‹æ‘˜è¦**:

```bash
cargo test --lib 2>&1 | grep -E "(test result:|running)"
```

**é¢„æœŸè¾“å‡ºç¤ºä¾‹**:
```
running 5 tests    # db::migrations
running 6 tests    # activity_grouper
running 9 tests    # markdown_generator
running 14 tests   # chunker
running 4 tests    # index_manager
running 12 tests   # hybrid_search
running 2 tests    # pipeline

test result: ok. 121 passed; 0 failed; 3 ignored
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¦‚æœæµ‹è¯•å¤±è´¥:

1. **ç¼–è¯‘é”™è¯¯** â†’ æ£€æŸ¥ä¾èµ–ç‰ˆæœ¬
   ```bash
   cargo clean
   cargo build
   ```

2. **æ•°æ®åº“é”™è¯¯** â†’ éªŒè¯è¿ç§»
   ```bash
   cargo test --lib db::migrations::tests::test_idempotent_migrations
   ```

3. **æ—¶åŒºç›¸å…³é”™è¯¯** â†’ æ—¶é—´æˆ³æµ‹è¯•å·²ä¿®å¤ä¸ºçµæ´»éªŒè¯

4. **Embeddingé”™è¯¯** â†’ éœ€è¦OpenAI API key(å¯é€‰,æµ‹è¯•ä¸éœ€è¦)

---

## ğŸ“ æ€§èƒ½åŸºå‡†

åœ¨MacBook Pro (M1)ä¸Šçš„æµ‹è¯•æ€§èƒ½:

```
æ‰€æœ‰121ä¸ªæµ‹è¯•: ~0.05ç§’
å•ä¸ªPhaseæµ‹è¯•: <0.01ç§’
```

---

## ğŸ‰ æˆåŠŸæ ‡å‡†

- âœ… æ‰€æœ‰121ä¸ªå•å…ƒæµ‹è¯•é€šè¿‡
- âœ… æ— ç¼–è¯‘é”™è¯¯
- âœ… æ— panicæˆ–unwrapé”™è¯¯
- âœ… æ•°æ®åº“è¿ç§»æ­£å¸¸
- âœ… æ´»åŠ¨åˆ†ç»„é€»è¾‘æ­£ç¡®
- âœ… Markdownæ ¼å¼ç¬¦åˆè§„èŒƒ

**å¦‚æœä»¥ä¸Šéƒ½é€šè¿‡,ç³»ç»Ÿæ ¸å¿ƒåŠŸèƒ½å·²å°±ç»ª!** ğŸš€
