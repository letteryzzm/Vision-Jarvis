# ğŸ§  Vision-Jarvis äº‹é¡¹é©±åŠ¨è®°å¿†ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

> **è®¾è®¡ç‰ˆæœ¬**: V2.0
> **åˆ›å»ºæ—¥æœŸ**: 2025-01-15
> **çŠ¶æ€**: è§„åˆ’ä¸­
> **å‚è€ƒæ¶æ„**: OpenClaw Memory System

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [æ ¸å¿ƒç†å¿µ](#æ ¸å¿ƒç†å¿µ)
3. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
4. [æ•°æ®æ¨¡å‹](#æ•°æ®æ¨¡å‹)
5. [æ ¸å¿ƒç®—æ³•](#æ ¸å¿ƒç®—æ³•)
6. [æ–‡ä»¶ç»„ç»‡](#æ–‡ä»¶ç»„ç»‡)
7. [æ•°æ®åº“Schema](#æ•°æ®åº“schema)
8. [å®æ–½è®¡åˆ’](#å®æ–½è®¡åˆ’)
9. [APIè®¾è®¡](#apiè®¾è®¡)
10. [é£é™©ä¸ç¼“è§£](#é£é™©ä¸ç¼“è§£)

---

## ç³»ç»Ÿæ¦‚è¿°

### å½“å‰é—®é¢˜

ç°æœ‰çš„è®°å¿†ç³»ç»Ÿä»¥**å•ä¸ªæˆªå›¾**ä¸ºç´¢å¼•å•ä½ï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
- ä¿¡æ¯ç¢ç‰‡åŒ–ï¼šç”¨æˆ·éš¾ä»¥å›å¿†å®Œæ•´çš„å·¥ä½œä¸Šä¸‹æ–‡
- æœç´¢ç»“æœåˆ†æ•£ï¼šè¿”å›å¤§é‡ç›¸ä¼¼çš„æˆªå›¾åˆ†æç»“æœ
- ç¼ºä¹å™äº‹æ€§ï¼šæ— æ³•ç†è§£"ç”¨æˆ·åœ¨ä¸€æ®µæ—¶é—´å†…åšäº†ä»€ä¹ˆ"

### æ ¸å¿ƒè½¬å˜

**ä»**ï¼šå•æˆªå›¾ â†’ AIåˆ†æ â†’ ç¢ç‰‡ç´¢å¼•
**åˆ°**ï¼šå¤šæˆªå›¾èšåˆ â†’ äº‹é¡¹Markdown â†’ æ•´ä½“ç´¢å¼•

### ç›®æ ‡

- âœ… å°†è¿ç»­ç›¸ä¼¼çš„æˆªå›¾èšåˆä¸ºæœ‰æ„ä¹‰çš„**æ´»åŠ¨ä¼šè¯(Activity Session)**
- âœ… æ¯ä¸ªæ´»åŠ¨ä¼šè¯ç”Ÿæˆ**å¯è¯»çš„Markdownæ–‡ä»¶**ï¼ŒåŒ…å«æˆªå›¾æ—¶é—´çº¿å’ŒAIæ€»ç»“
- âœ… åŸºäºOpenClawæ¶æ„å®ç°**æ··åˆæœç´¢**ï¼ˆå‘é‡+BM25ï¼‰
- âœ… æä¾›**äº‹é¡¹çº§åˆ«**çš„æœç´¢å’Œæµè§ˆä½“éªŒ
- âœ… æ”¯æŒ**å‘¨/æœˆæ€»ç»“**è‡ªåŠ¨ç”Ÿæˆ

---

## æ ¸å¿ƒç†å¿µ

### "äº‹é¡¹å³Markdown"

ç±»ä¼¼OpenClawçš„"Markdownå³æ•°æ®åº“"ç†å¿µï¼ŒVision-Jarvisé‡‡ç”¨ï¼š

- **æ–‡ä»¶ç³»ç»Ÿä¸ºå†…å®¹æº**ï¼šæ´»åŠ¨ä»¥Markdownæ–‡ä»¶å­˜å‚¨ï¼Œç”¨æˆ·å¯ç›´æ¥æŸ¥çœ‹å’Œç¼–è¾‘
- **æ•°æ®åº“ä¸ºç´¢å¼•å±‚**ï¼šSQLiteå­˜å‚¨å…ƒæ•°æ®å’Œå‘é‡ç´¢å¼•ï¼Œæä¾›å¿«é€Ÿæ£€ç´¢
- **æ··åˆæ•°æ®æ¨¡å‹**ï¼šç»“åˆæ–‡ä»¶ç³»ç»Ÿçš„å¯è¯»æ€§ä¸æ•°æ®åº“çš„æŸ¥è¯¢æ€§èƒ½

### æ´»åŠ¨ä¼šè¯å®šä¹‰

**æ´»åŠ¨ä¼šè¯**ï¼ˆActivity Sessionï¼‰æ˜¯æŒ‡ï¼š
- ç”¨æˆ·åœ¨ä¸€æ®µæ—¶é—´å†…åšçš„**ä¸€ä»¶å®Œæ•´çš„äº‹æƒ…**
- ç”±å¤šå¼ è¿ç»­çš„ç›¸ä¼¼æˆªå›¾ç»„æˆ
- å…·æœ‰æ˜ç¡®çš„å¼€å§‹å’Œç»“æŸæ—¶é—´
- ä¸»è¦åœ¨**ä¸€ä¸ªåº”ç”¨ç¨‹åº**ä¸­è¿›è¡Œ

**ç¤ºä¾‹**ï¼š
- âœ… "14:30-15:45 ä½¿ç”¨VSCodeç¼–å†™Rustä»£ç "
- âœ… "09:00-10:30 åœ¨Chromeæµè§ˆå™¨æŸ¥é˜…æŠ€æœ¯æ–‡æ¡£"
- âœ… "16:00-16:45 ä½¿ç”¨Figmaè®¾è®¡UIç•Œé¢"

---

## æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®é‡‡é›†å±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ æˆªå›¾é‡‡é›†å™¨    â”‚â”€â”€â”€â”€â–¶â”‚ AIåˆ†æå™¨     â”‚                      â”‚
â”‚  â”‚ (æ¯5ç§’)      â”‚     â”‚ (æ¯5åˆ†é’Ÿæ‰¹é‡) â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ´»åŠ¨èšåˆå±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚         ActivityGrouper (æ ¸å¿ƒç®—æ³•)            â”‚           â”‚
â”‚  â”‚  - ç›¸åŒåº”ç”¨ + æ—¶é—´é—´éš” < 5åˆ†é’Ÿ                 â”‚           â”‚
â”‚  â”‚  - æ´»åŠ¨ç›¸ä¼¼åº¦åˆ¤æ–­                             â”‚           â”‚
â”‚  â”‚  - æœ€çŸ­60ç§’ï¼Œæœ€é•¿2å°æ—¶                        â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å†…å®¹ç”Ÿæˆå±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚        MarkdownGenerator                     â”‚           â”‚
â”‚  â”‚  - YAML frontmatter (å…ƒæ•°æ®)                  â”‚           â”‚
â”‚  â”‚  - AIæ€»ç»“æ­£æ–‡ (200-300å­—)                     â”‚           â”‚
â”‚  â”‚  - æˆªå›¾æ—¶é—´çº¿                                 â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç´¢å¼•æ£€ç´¢å±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚        MemoryIndexManager                    â”‚           â”‚
â”‚  â”‚  - æ–‡ä»¶ç›‘å¬ + å¢é‡ç´¢å¼•                        â”‚           â”‚
â”‚  â”‚  - æ–‡æœ¬åˆ†å— (400 tokens, 80 overlap)         â”‚           â”‚
â”‚  â”‚  - Embeddingç”Ÿæˆ + ç¼“å­˜                       â”‚           â”‚
â”‚  â”‚  - æ··åˆæœç´¢ (Vector 70% + BM25 30%)          â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨æ¥å£å±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ è¯­ä¹‰æœç´¢     â”‚  â”‚ æ—¥æœŸæŸ¥è¯¢     â”‚  â”‚ è¯¦æƒ…è·å–     â”‚      â”‚
â”‚  â”‚ (Tauriå‘½ä»¤)  â”‚  â”‚ (Tauriå‘½ä»¤)  â”‚  â”‚ (Tauriå‘½ä»¤)  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµç®¡é“

```
[æˆªå›¾é‡‡é›†] æ¯5ç§’
    â†“
[screenshotsè¡¨] analyzed=0
    â†“
[AIåˆ†æå™¨] æ¯5åˆ†é’Ÿæ‰¹é‡åˆ†æ
    â†“
[screenshotsè¡¨] analysis_result JSON
    â†“
[æ´»åŠ¨åˆ†ç»„å™¨] æ¯30åˆ†é’Ÿ â† æ ¸å¿ƒæ–°æ¨¡å—
    - æŸ¥è¯¢æœªåˆ†ç»„çš„å·²åˆ†ææˆªå›¾
    - æŒ‰æ—¶é—´æ’åº
    - åº”ç”¨åˆ†ç»„ç®—æ³•
    - ç”ŸæˆActivitySessionåˆ—è¡¨
    â†“
[Markdownç”Ÿæˆå™¨]
    - ä¸ºæ¯ä¸ªActivitySessionç”Ÿæˆ.mdæ–‡ä»¶
    - frontmatter: å…ƒæ•°æ® + æˆªå›¾åˆ—è¡¨
    - æ­£æ–‡: AIæ€»ç»“ (è°ƒç”¨GPT-4)
    â†“
[ä¿å­˜æ–‡ä»¶] activities/YYYY-MM-DD/activity-NNN.md
    â†“
[æ›´æ–°æ•°æ®åº“]
    - activitiesè¡¨: æ’å…¥äº‹é¡¹å…ƒæ•°æ®
    - screenshotsè¡¨: æ›´æ–°activity_idå¤–é”®
    â†“
[ç´¢å¼•ç®¡ç†å™¨] æ¯10åˆ†é’Ÿå¢é‡åŒæ­¥
    - æ‰«æactivities/ç›®å½•
    - å¯¹æ¯”æ–‡ä»¶å“ˆå¸Œ
    - è§£æfrontmatter
    - åˆ†å—æ­£æ–‡
    - ç”Ÿæˆ/ç¼“å­˜embedding
    - å†™å…¥memory_chunksè¡¨
    â†“
[æ··åˆæœç´¢å¼•æ“]
    - å‘é‡æ£€ç´¢ (cosine similarity)
    - BM25å…³é”®è¯æ£€ç´¢
    - åŠ æƒåˆå¹¶ (0.7 + 0.3)
    - è¿”å›æŒ‰æ´»åŠ¨èšåˆçš„ç»“æœ
    â†“
[å‰ç«¯å±•ç¤º] äº‹é¡¹å¡ç‰‡ + æˆªå›¾æ—¶é—´çº¿
```

---

## æ•°æ®æ¨¡å‹

### ActivitySession ç»“æ„

```rust
pub struct ActivitySession {
    pub id: String,                          // "activity-2024-01-15-001"
    pub title: String,                       // "ç¼–å†™Rustä»£ç å®ç°è®°å¿†ç³»ç»Ÿ"
    pub start_time: i64,                     // Unixæ—¶é—´æˆ³
    pub end_time: i64,                       // Unixæ—¶é—´æˆ³
    pub duration_minutes: i64,               // è®¡ç®—å¾—å‡º
    pub application: String,                 // "Visual Studio Code"
    pub category: ActivityCategory,          // ç¼–ç¨‹/å¨±ä¹/å·¥ä½œ/å­¦ä¹ /å…¶ä»–
    pub screenshot_ids: Vec<String>,         // å…³è”çš„æˆªå›¾IDåˆ—è¡¨
    pub screenshot_analyses: Vec<ScreenshotAnalysisSummary>,
    pub tags: Vec<String>,                   // ["Rust", "æ•°æ®åº“", "è®°å¿†ç³»ç»Ÿ"]
    pub markdown_path: String,               // ç›¸å¯¹è·¯å¾„
    pub summary: Option<String>,             // AIç”Ÿæˆçš„æ€»ç»“
    pub indexed: bool,                       // æ˜¯å¦å·²ç´¢å¼•
    pub created_at: i64,
}
```

### Markdownæ–‡ä»¶æ ¼å¼

#### Frontmatter Schema (YAML)

```yaml
---
# === æ ¸å¿ƒæ ‡è¯† ===
id: "activity-2024-01-15-001"
title: "ç¼–å†™Rustä»£ç å®ç°è®°å¿†ç³»ç»Ÿ"
version: 1

# === æ—¶é—´ä¿¡æ¯ ===
start_time: "2024-01-15T14:30:00Z"
end_time: "2024-01-15T15:45:00Z"
duration_minutes: 75

# === åº”ç”¨ä¸åˆ†ç±» ===
application: "Visual Studio Code"
category: "ç¼–ç¨‹"

# === æˆªå›¾æ—¶é—´çº¿ ===
screenshots:
  - id: "screenshot-2024-01-15-143000"
    timestamp: "2024-01-15T14:30:00Z"
    path: "screenshots/2024-01-15/14-30-00.png"
    analysis: "ç”¨æˆ·æ­£åœ¨ç¼–å†™Rustä»£ç ï¼Œæ–‡ä»¶åä¸ºmemory_index.rs"

  - id: "screenshot-2024-01-15-143500"
    timestamp: "2024-01-15T14:35:00Z"
    path: "screenshots/2024-01-15/14-35-00.png"
    analysis: "ç”¨æˆ·åœ¨æŸ¥çœ‹SQLiteæ–‡æ¡£"

  - id: "screenshot-2024-01-15-144000"
    timestamp: "2024-01-15T14:40:00Z"
    path: "screenshots/2024-01-15/14-40-00.png"
    analysis: "ç»§ç»­ç¼–å†™ä»£ç ï¼Œå®ç°æ•°æ®åº“æŸ¥è¯¢"

# === å…ƒæ•°æ® ===
tags: ["ç¼–ç¨‹", "Rust", "æ•°æ®åº“", "è®°å¿†ç³»ç»Ÿ"]
created_at: "2024-01-15T16:00:00Z"
---
```

#### æ­£æ–‡æ ¼å¼

```markdown
# ç¼–å†™Rustä»£ç å®ç°è®°å¿†ç³»ç»Ÿ

ç”¨æˆ·åœ¨ä»Šå¤©ä¸‹åˆèŠ±äº†75åˆ†é’Ÿå®ç°Vision-Jarvisçš„è®°å¿†ç³»ç»Ÿæ ¸å¿ƒæ¨¡å—ã€‚ä¸»è¦å·¥ä½œåŒ…æ‹¬ï¼š

1. **æ•°æ®åº“Schemaè®¾è®¡** - è®¾è®¡äº†activitiesã€memory_chunksã€memory_filesä¸‰å¼ æ–°è¡¨ï¼Œå»ºç«‹äº†äº‹é¡¹ä¸æˆªå›¾ã€Markdownæ–‡ä»¶çš„å…³è”å…³ç³»ã€‚

2. **MemoryIndexManagerå®ç°** - å®ç°äº†æ ¸å¿ƒç´¢å¼•ç®¡ç†å™¨ï¼Œè´Ÿè´£æ–‡ä»¶ç›‘å¬ã€å“ˆå¸Œå¯¹æ¯”ã€å¢é‡ç´¢å¼•ç­‰åŠŸèƒ½ã€‚æœŸé—´æŸ¥é˜…äº†SQLiteå’ŒRustæ–‡æ¡£çº¦15åˆ†é’Ÿã€‚

3. **å‘é‡æ£€ç´¢é›†æˆ** - é›†æˆäº†embeddingç”Ÿæˆå’Œç¼“å­˜æœºåˆ¶ï¼Œä¸ºæ··åˆæœç´¢å¥ å®šåŸºç¡€ã€‚

æ•´ä½“å·¥ä½œèŠ‚å¥ç¨³å®šï¼Œä¸­é—´æŸ¥é˜…æ–‡æ¡£å’Œæ€è€ƒæ¶æ„è®¾è®¡å ç”¨çº¦20åˆ†é’Ÿã€‚ä»£ç ç¼–å†™ä¸“æ³¨åº¦é«˜ï¼ŒæœŸé—´æœªåˆ‡æ¢åˆ°å…¶ä»–åº”ç”¨ã€‚è¿™æ¬¡å®ç°å®Œæˆäº†è®°å¿†ç³»ç»Ÿçš„æ ¸å¿ƒæ•°æ®æµç®¡é“ï¼Œä¸ºåç»­çš„æœç´¢åŠŸèƒ½æ‰“ä¸‹åŸºç¡€ã€‚
```

### MemoryChunk ç»“æ„

```rust
pub struct MemoryChunk {
    pub id: String,                          // UUID
    pub file_path: String,                   // "activities/2024-01-15/activity-001.md"
    pub source: MemorySource,                // Activity | Summary
    pub start_line: i32,                     // åˆ†å—èµ·å§‹è¡Œå·
    pub end_line: i32,                       // åˆ†å—ç»“æŸè¡Œå·
    pub hash: String,                        // SHA-256å“ˆå¸Œ(å‰16å­—ç¬¦)
    pub model: String,                       // "text-embedding-3-small"
    pub text: String,                        // åˆ†å—æ–‡æœ¬å†…å®¹
    pub embedding: Vec<f32>,                 // å‘é‡(1536ç»´)
    pub activity_id: Option<String>,         // å…³è”çš„activity ID
    pub updated_at: i64,
}
```

---

## æ ¸å¿ƒç®—æ³•

### æ´»åŠ¨åˆ†ç»„ç®—æ³•

#### é…ç½®å‚æ•°

```rust
pub struct GroupingConfig {
    pub max_gap_seconds: i64,        // æœ€å¤§æ—¶é—´é—´éš”: 300ç§’ (5åˆ†é’Ÿ)
    pub min_screenshots: usize,      // æœ€å°‘æˆªå›¾æ•°: 2
    pub max_duration_seconds: i64,   // æœ€é•¿æŒç»­æ—¶é—´: 7200ç§’ (2å°æ—¶)
    pub min_duration_seconds: i64,   // æœ€çŸ­æŒç»­æ—¶é—´: 60ç§’ (1åˆ†é’Ÿ)
}
```

#### åˆ†ç»„å†³ç­–çŸ©é˜µ

| æ¡ä»¶ | åˆ¤æ–­æ ‡å‡† | ä¼˜å…ˆçº§ |
|------|---------|--------|
| **åº”ç”¨ç¨‹åº** | å¿…é¡»ç›¸åŒ | P0 (ç¡¬æ€§è¦æ±‚) |
| **æ—¶é—´é—´éš”** | â‰¤ 5åˆ†é’Ÿ | P0 (ç¡¬æ€§è¦æ±‚) |
| **æ´»åŠ¨ç±»å‹** | ç›¸åŒæˆ–ç›¸å…³ | P1 (è½¯æ€§è¦æ±‚) |
| **æŒç»­æ—¶é•¿** | < 2å°æ—¶ | P1 (é˜²æ­¢è¿‡é•¿) |

#### ä¼ªä»£ç å®ç°

```
FUNCTION group_screenshots(screenshots, config):
    groups = []
    current_group = None

    FOR each screenshot IN sorted(screenshots, by: captured_at):
        IF screenshot.analyzed == false:
            SKIP

        parsed = parse_analysis_result(screenshot.analysis_result)

        IF current_group is None:
            current_group = create_new_group(screenshot, parsed)
            CONTINUE

        # è®¡ç®—å†³ç­–å‚æ•°
        time_gap = screenshot.captured_at - current_group.last_timestamp
        is_same_app = (parsed.application == current_group.application)
        is_same_activity = (parsed.activity == current_group.activity)
        current_duration = screenshot.captured_at - current_group.start_timestamp

        # å†³ç­–: æ˜¯å¦åˆå¹¶åˆ°å½“å‰ç»„
        should_merge = ALL_OF(
            time_gap <= config.max_gap_seconds,
            is_same_app,
            (is_same_activity OR activities_are_related(current_group.activity, parsed.activity)),
            current_duration <= config.max_duration_seconds
        )

        IF should_merge:
            current_group.add(screenshot, parsed)
        ELSE:
            # ä¿å­˜å½“å‰ç»„(å¦‚æœæ»¡è¶³æœ€å°è¦æ±‚)
            IF current_group.meets_minimum_criteria(config):
                groups.push(current_group.finalize())

            # å¼€å¯æ–°ç»„
            current_group = create_new_group(screenshot, parsed)

    # å¤„ç†æœ€åä¸€ä¸ªç»„
    IF current_group is not None AND current_group.meets_minimum_criteria(config):
        groups.push(current_group.finalize())

    RETURN groups
```

#### æ´»åŠ¨ç›¸å…³æ€§åˆ¤æ–­

```
FUNCTION activities_are_related(activity_a, activity_b):
    # V1: ç®€å•çš„å­—ç¬¦ä¸²åŒ¹é…
    # V2: å¯è€ƒè™‘ä½¿ç”¨embeddingç›¸ä¼¼åº¦

    # å‰ç¼€åŒ¹é…
    IF activity_a.starts_with(activity_b) OR activity_b.starts_with(activity_a):
        RETURN true

    # æå–å…³é”®åŠ¨è¯
    verbs_a = extract_verbs(activity_a)  # ["ç¼–å†™", "ä»£ç "]
    verbs_b = extract_verbs(activity_b)  # ["è°ƒè¯•", "ä»£ç "]

    # æœ‰å…±åŒåŠ¨è¯
    IF intersection(verbs_a, verbs_b).length > 0:
        RETURN true

    RETURN false
```

### æ–‡æœ¬åˆ†å—ç­–ç•¥

ç»§æ‰¿è‡ªOpenClawçš„æˆç†Ÿå‚æ•°ï¼š

```rust
pub struct ChunkConfig {
    pub target_tokens: usize,      // 400 tokens
    pub overlap_tokens: usize,     // 80 tokens
}
```

#### åˆ†å—é€»è¾‘

```
FUNCTION chunk_markdown(text, config):
    lines = split_lines(text)
    chunks = []

    # 1. æ£€æµ‹frontmatterè¾¹ç•Œ
    (frontmatter_end, body_start) = detect_frontmatter_bounds(lines)

    # 2. Frontmatterä½œä¸ºå•ç‹¬ä¸€å—(ä¸åˆ†å‰²)
    IF frontmatter_end > 0:
        fm_text = join(lines[0..frontmatter_end])
        chunks.push({
            start_line: 1,
            end_line: frontmatter_end,
            text: fm_text,
            hash: sha256(fm_text)[0..16]
        })

    # 3. æ­£æ–‡æŒ‰tokenæ•°åˆ†å—
    body_lines = lines[body_start..]
    current_chunk = []
    current_tokens = 0
    start_line = body_start

    FOR i, line IN enumerate(body_lines):
        line_tokens = estimate_tokens(line)

        IF current_tokens + line_tokens > config.target_tokens:
            # ä¿å­˜å½“å‰å—
            chunks.push({
                start_line: start_line,
                end_line: body_start + i,
                text: join(current_chunk),
                hash: sha256(join(current_chunk))[0..16]
            })

            # ä¿ç•™overlapè¡Œ
            overlap_count = calculate_overlap_lines(current_chunk, config.overlap_tokens)
            current_chunk = current_chunk[-overlap_count..]
            current_tokens = sum(estimate_tokens(line) for line in current_chunk)
            start_line = body_start + i - overlap_count

        current_chunk.push(line)
        current_tokens += line_tokens

    # 4. ä¿å­˜æœ€åä¸€å—
    IF current_chunk.length > 0:
        chunks.push({
            start_line: start_line,
            end_line: body_start + body_lines.length,
            text: join(current_chunk),
            hash: sha256(join(current_chunk))[0..16]
        })

    RETURN chunks
```

#### Tokenä¼°ç®—

```rust
fn estimate_tokens(text: &str) -> usize {
    let cjk_count = text.chars().filter(|c| is_cjk(*c)).count();
    let ascii_len = text.len() - cjk_count * 3;  // CJK 3å­—èŠ‚UTF-8
    cjk_count + ascii_len / 4  // CJK ~1 token/char, ASCII ~4 chars/token
}
```

### æ··åˆæœç´¢ç®—æ³•

ç»§æ‰¿è‡ªOpenClawçš„70/30æƒé‡é…ç½®ï¼š

```rust
pub struct HybridSearchConfig {
    pub vector_weight: f32,         // 0.7
    pub keyword_weight: f32,        // 0.3
    pub max_results: usize,         // 10
    pub min_score: f32,             // 0.3
    pub candidate_multiplier: usize, // 4 (å€™é€‰æ± æ”¾å¤§å€æ•°)
}
```

#### æœç´¢æµç¨‹

```
FUNCTION hybrid_search(query, config):
    # 1. ç”ŸæˆæŸ¥è¯¢å‘é‡
    query_embedding = generate_embedding(query)

    # 2. å‘é‡æ£€ç´¢ (æ‰©å¤§å€™é€‰æ± )
    candidate_count = config.max_results * config.candidate_multiplier
    vector_results = vector_search(query_embedding, candidate_count)

    # 3. å…³é”®è¯æ£€ç´¢ (BM25æˆ–ç®€å•LIKE)
    keyword_results = keyword_search(query, candidate_count)

    # 4. ç»“æœåˆå¹¶
    merged = merge_results(vector_results, keyword_results, config)

    # 5. è¿‡æ»¤å’Œæˆªæ–­
    filtered = filter(merged, score >= config.min_score)
    final = take(filtered, config.max_results)

    RETURN final

FUNCTION merge_results(vector_results, keyword_results, config):
    results_by_id = {}

    # æ·»åŠ å‘é‡ç»“æœ
    FOR result IN vector_results:
        results_by_id[result.chunk_id] = {
            ...result,
            vector_score: result.score,
            keyword_score: 0
        }

    # åˆå¹¶å…³é”®è¯ç»“æœ
    FOR result IN keyword_results:
        IF result.chunk_id IN results_by_id:
            results_by_id[result.chunk_id].keyword_score = result.score
        ELSE:
            results_by_id[result.chunk_id] = {
                ...result,
                vector_score: 0,
                keyword_score: result.score
            }

    # è®¡ç®—æ··åˆåˆ†æ•°
    FOR id, result IN results_by_id:
        result.combined_score =
            config.vector_weight * result.vector_score +
            config.keyword_weight * result.keyword_score

    # æŒ‰æ··åˆåˆ†æ•°æ’åº
    sorted_results = sort(results_by_id.values(), by: combined_score, desc)

    RETURN sorted_results
```

---

## æ–‡ä»¶ç»„ç»‡

### ç›®å½•ç»“æ„

```
~/Library/Application Support/vision-jarvis/
â”œâ”€â”€ screenshots/                    # åŸå§‹æˆªå›¾(ç°æœ‰)
â”‚   â”œâ”€â”€ 2024-01-15/
â”‚   â”‚   â”œâ”€â”€ 14-30-00.png
â”‚   â”‚   â”œâ”€â”€ 14-35-00.png
â”‚   â”‚   â””â”€â”€ 14-40-00.png
â”‚   â””â”€â”€ 2024-01-16/
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ activities/                     # ğŸ†• æ´»åŠ¨Markdownæ–‡ä»¶
â”‚   â”œâ”€â”€ 2024-01-15/
â”‚   â”‚   â”œâ”€â”€ activity-001.md        # ç¬¬ä¸€ä¸ªæ´»åŠ¨
â”‚   â”‚   â”œâ”€â”€ activity-002.md        # ç¬¬äºŒä¸ªæ´»åŠ¨
â”‚   â”‚   â””â”€â”€ activity-003.md
â”‚   â””â”€â”€ 2024-01-16/
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ summaries/                      # ğŸ†• é•¿æœŸè®°å¿†æ€»ç»“
â”‚   â”œâ”€â”€ 2024-W03.md                # 2024å¹´ç¬¬3å‘¨æ€»ç»“
â”‚   â”œâ”€â”€ 2024-W04.md
â”‚   â”œâ”€â”€ 2024-01.md                 # 2024å¹´1æœˆæ€»ç»“
â”‚   â””â”€â”€ 2024-02.md
â”‚
â”œâ”€â”€ memory/                         # ğŸ†• å‘é‡ç´¢å¼•æ•°æ®åº“
â”‚   â””â”€â”€ index.sqlite               # ç‹¬ç«‹çš„ç´¢å¼•æ•°æ®åº“
â”‚
â”œâ”€â”€ vision-jarvis.db                # ä¸»æ•°æ®åº“(ç°æœ‰)
â””â”€â”€ settings.json                   # åº”ç”¨è®¾ç½®(ç°æœ‰)
```

### æ–‡ä»¶å‘½åè§„åˆ™

#### æ´»åŠ¨Markdown

- **æ ¼å¼**: `activities/YYYY-MM-DD/activity-NNN.md`
- **NNN**: ä¸‰ä½æ•°åºå·ï¼Œä»001å¼€å§‹ï¼Œæ¯å¤©é‡æ–°è®¡æ•°
- **ç¤ºä¾‹**:
  - `activities/2024-01-15/activity-001.md`
  - `activities/2024-01-15/activity-002.md`
  - `activities/2024-01-16/activity-001.md`

#### å‘¨æ€»ç»“

- **æ ¼å¼**: `summaries/YYYY-WNN.md`
- **NN**: ISO 8601å‘¨æ•° (01-53)
- **ç¤ºä¾‹**:
  - `summaries/2024-W01.md` (2024å¹´ç¬¬1å‘¨)
  - `summaries/2024-W52.md` (2024å¹´ç¬¬52å‘¨)

#### æœˆæ€»ç»“

- **æ ¼å¼**: `summaries/YYYY-MM.md`
- **ç¤ºä¾‹**:
  - `summaries/2024-01.md` (2024å¹´1æœˆ)
  - `summaries/2024-12.md` (2024å¹´12æœˆ)

---

## æ•°æ®åº“Schema

### ï¿½ï¿½ï¿½è®¡åŸåˆ™

- **æ··åˆæ¨¡å‹**: æ•°æ®åº“å­˜å…ƒæ•°æ®å’Œç´¢å¼•ï¼Œæ–‡ä»¶ç³»ç»Ÿå­˜å†…å®¹
- **å‘åå…¼å®¹**: V1è¡¨ä¿ç•™ä¸å˜ï¼ŒV2é‡‡ç”¨å¢é‡è¿ç§»
- **å¤–é”®å…³è”**: å»ºç«‹screenshots â†” activities â†” markdownæ–‡ä»¶çš„é“¾æ¥

### æ–°å¢è¡¨ (V2 Migration)

#### 1. activities - æ´»åŠ¨ä¼šè¯å…ƒæ•°æ®

```sql
CREATE TABLE IF NOT EXISTS activities (
    id TEXT PRIMARY KEY,                    -- "activity-2024-01-15-001"
    title TEXT NOT NULL,                    -- "ç¼–å†™Rustä»£ç å®ç°è®°å¿†ç³»ç»Ÿ"
    start_time INTEGER NOT NULL,            -- Unixæ—¶é—´æˆ³
    end_time INTEGER NOT NULL,              -- Unixæ—¶é—´æˆ³
    duration_minutes INTEGER NOT NULL,      -- è®¡ç®—å¾—å‡º
    application TEXT NOT NULL,              -- "Visual Studio Code"
    category TEXT NOT NULL,                 -- "ç¼–ç¨‹" (JSONåºåˆ—åŒ–çš„enum)
    screenshot_ids TEXT NOT NULL,           -- JSONæ•°ç»„: ["id1", "id2"]
    tags TEXT NOT NULL DEFAULT '[]',        -- JSONæ•°ç»„: ["Rust", "æ•°æ®åº“"]
    markdown_path TEXT NOT NULL,            -- ç›¸å¯¹è·¯å¾„
    summary TEXT,                           -- AIæ€»ç»“(å¯é€‰)
    indexed INTEGER DEFAULT 0,              -- æ˜¯å¦å·²ç´¢å¼•
    created_at INTEGER NOT NULL DEFAULT (strftime('%s', 'now'))
);

CREATE INDEX IF NOT EXISTS idx_activities_time ON activities(start_time DESC);
CREATE INDEX IF NOT EXISTS idx_activities_application ON activities(application);
CREATE INDEX IF NOT EXISTS idx_activities_category ON activities(category);
CREATE INDEX IF NOT EXISTS idx_activities_indexed ON activities(indexed);
```

#### 2. memory_files - æ–‡ä»¶è¿½è¸ª

```sql
CREATE TABLE IF NOT EXISTS memory_files (
    path TEXT PRIMARY KEY,                  -- ç›¸å¯¹è·¯å¾„ "activities/2024-01-15/activity-001.md"
    source TEXT NOT NULL DEFAULT 'activity', -- "activity" | "summary"
    hash TEXT NOT NULL,                     -- æ–‡ä»¶å†…å®¹SHA-256å“ˆå¸Œ
    mtime INTEGER NOT NULL,                 -- ä¿®æ”¹æ—¶é—´(ç”¨äºå¢é‡æ£€æµ‹)
    size INTEGER NOT NULL                   -- æ–‡ä»¶å¤§å°(å­—èŠ‚)
);
```

**ç”¨é€”**: å¢é‡ç´¢å¼•çš„å…³é”® - é€šè¿‡å¯¹æ¯”hashåˆ¤æ–­æ–‡ä»¶æ˜¯å¦å˜åŒ–

#### 3. memory_chunks - æ–‡æœ¬åˆ†å—ä¸å‘é‡

```sql
CREATE TABLE IF NOT EXISTS memory_chunks (
    id TEXT PRIMARY KEY,                    -- UUID
    file_path TEXT NOT NULL,                -- å¤–é”®æŒ‡å‘memory_files.path
    source TEXT NOT NULL DEFAULT 'activity', -- "activity" | "summary"
    start_line INTEGER NOT NULL,            -- åˆ†å—èµ·å§‹è¡Œ
    end_line INTEGER NOT NULL,              -- åˆ†å—ç»“æŸè¡Œ
    hash TEXT NOT NULL,                     -- åˆ†å—ï¿½ï¿½å®¹å“ˆå¸Œ
    model TEXT NOT NULL,                    -- "text-embedding-3-small"
    text TEXT NOT NULL,                     -- åˆ†å—æ–‡æœ¬
    embedding BLOB NOT NULL,                -- f32å‘é‡(åºåˆ—åŒ–ä¸ºbytes)
    activity_id TEXT,                       -- å…³è”çš„activity ID(å¯ä¸ºç©º)
    updated_at INTEGER NOT NULL,
    FOREIGN KEY (file_path) REFERENCES memory_files(path)
);

CREATE INDEX IF NOT EXISTS idx_chunks_file_path ON memory_chunks(file_path);
CREATE INDEX IF NOT EXISTS idx_chunks_activity_id ON memory_chunks(activity_id);
CREATE INDEX IF NOT EXISTS idx_chunks_hash ON memory_chunks(hash);
```

#### 4. embedding_cache - Embeddingç¼“å­˜

```sql
CREATE TABLE IF NOT EXISTS embedding_cache (
    provider TEXT NOT NULL,                 -- "openai"
    model TEXT NOT NULL,                    -- "text-embedding-3-small"
    hash TEXT NOT NULL,                     -- æ–‡æœ¬å†…å®¹å“ˆå¸Œ
    embedding BLOB NOT NULL,                -- ç¼“å­˜çš„å‘é‡
    dims INTEGER,                           -- å‘é‡ç»´åº¦(1536)
    updated_at INTEGER NOT NULL,
    PRIMARY KEY (provider, model, hash)
);

CREATE INDEX IF NOT EXISTS idx_embedding_cache_updated
    ON embedding_cache(updated_at);
```

**ç”¨é€”**: é¿å…é‡å¤è®¡ç®—ç›¸åŒæ–‡æœ¬çš„embeddingï¼ŒèŠ‚çœAPIæˆæœ¬

#### 5. schema_meta - è¿ç§»ç‰ˆæœ¬è¿½è¸ª

```sql
CREATE TABLE IF NOT EXISTS schema_meta (
    key TEXT PRIMARY KEY,
    value TEXT NOT NULL
);

-- åˆå§‹å€¼
INSERT OR REPLACE INTO schema_meta (key, value) VALUES ('schema_version', '2');
```

### ä¿®æ”¹ç°æœ‰è¡¨

#### screenshots è¡¨å¢åŠ å¤–é”®

```sql
-- V2è¿ç§»æ—¶æ‰§è¡Œ
ALTER TABLE screenshots ADD COLUMN activity_id TEXT;

CREATE INDEX IF NOT EXISTS idx_screenshots_activity_id
    ON screenshots(activity_id);
```

### å®ä½“å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  screenshots     â”‚           â”‚   activities     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)          â”‚â—„â”€â”€â”       â”‚ id (PK)          â”‚
â”‚ path             â”‚   â”‚       â”‚ title            â”‚
â”‚ captured_at      â”‚   â”‚       â”‚ start_time       â”‚
â”‚ analyzed         â”‚   â”‚       â”‚ screenshot_ids   â”‚â”€â”€â”
â”‚ analysis_result  â”‚   â”‚       â”‚ markdown_path    â”‚  â”‚
â”‚ activity_id (FK) â”‚â”€â”€â”€â”˜       â”‚ category         â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ indexed          â”‚  â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                        â”‚            â”‚
                                        â”‚ (links to) â”‚
                                        â–¼            â”‚
                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                               â”‚  memory_files    â”‚  â”‚
                               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
                               â”‚ path (PK)        â”‚â—„â”€â”˜
                               â”‚ hash             â”‚
                               â”‚ mtime            â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚ (1:N)
                                        â–¼
                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                               â”‚ memory_chunks    â”‚
                               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                               â”‚ id (PK)          â”‚
                               â”‚ file_path (FK)   â”‚
                               â”‚ text             â”‚
                               â”‚ embedding (BLOB) â”‚
                               â”‚ activity_id      â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®æ–½è®¡åˆ’

### æ€»å·¥æœŸ: 12ä¸ªå·¥ä½œæ—¥

### Phase 1: æ•°æ®åº“åŸºç¡€ (2å¤©)

**ç›®æ ‡**: å»ºç«‹V2 Schemaå’Œè¿ç§»ç³»ç»Ÿ

#### Step 1.1: å®šä¹‰æ–°æ•°æ®ç±»å‹
- **æ–‡ä»¶**: `src/db/schema.rs`
- **ä»»åŠ¡**:
  - æ·»åŠ  `ActivitySession` ç»“æ„ä½“
  - æ·»åŠ  `MemoryChunk` ç»“æ„ä½“
  - æ·»åŠ  `TrackedFile` ç»“æ„ä½“
  - æ·»åŠ  `MemorySource` æšä¸¾
  - æ·»åŠ  `ScreenshotAnalysisSummary` ç»“æ„ä½“
- **ä¾èµ–**: æ— 
- **é£é™©**: ä½

#### Step 1.2: åˆ›å»ºV2è¿ç§»
- **æ–‡ä»¶**: `src/db/migrations.rs`
- **ä»»åŠ¡**:
  - å®ç°ç‰ˆæœ¬è¿½è¸ªç³»ç»Ÿ (`schema_meta` è¡¨)
  - åˆ›å»º `activities` è¡¨
  - åˆ›å»º `memory_files` è¡¨
  - åˆ›å»º `memory_chunks` è¡¨
  - åˆ›å»º `embedding_cache` è¡¨
  - ä¸º `screenshots` è¡¨æ·»åŠ  `activity_id` åˆ—
- **ä¾èµ–**: Step 1.1
- **é£é™©**: ä¸­ (éœ€è¦å¤„ç†ç°æœ‰æ•°æ®åº“)

#### Step 1.3: æµ‹è¯•è¿ç§»
- **ä»»åŠ¡**:
  - æµ‹è¯•å…¨æ–°å®‰è£… (V2ç›´æ¥åˆ›å»º)
  - æµ‹è¯•V1â†’V2å‡çº§ (ALTER TABLEå…¼å®¹æ€§)
  - éªŒè¯æ‰€æœ‰ç´¢å¼•æ­£ç¡®åˆ›å»º
- **ä¾èµ–**: Step 1.2
- **é£é™©**: ä½

---

### Phase 2: æ´»åŠ¨åˆ†ç»„å™¨ (2å¤©)

**ç›®æ ‡**: å®ç°æ ¸å¿ƒçš„æˆªå›¾èšåˆç®—æ³•

#### Step 2.1: åˆ†ç»„ç®—æ³•å®ç°
- **æ–‡ä»¶**: `src/memory/activity_grouper.rs` (NEW)
- **ä»»åŠ¡**:
  - å®ç° `GroupingConfig` é…ç½®
  - å®ç° `group_screenshots()` æ ¸å¿ƒç®—æ³•
  - å®ç° `activities_are_related()` è¾…åŠ©å‡½æ•°
  - å®ç° `ActivityGroup` ä¸´æ—¶ç»“æ„
- **ä¾èµ–**: Phase 1
- **é£é™©**: é«˜ (ç®—æ³•è´¨é‡ç›´æ¥å½±å“ç”¨æˆ·ä½“éªŒ)

#### Step 2.2: æ•°æ®åº“é›†æˆ
- **æ–‡ä»¶**: `src/memory/activity_grouper.rs`
- **ä»»åŠ¡**:
  - å®ç° `get_ungrouped_screenshots()` æŸ¥è¯¢
  - å®ç° `save_activity()` å­˜å‚¨
  - å®ç°äº‹åŠ¡ç®¡ç† (activities + screenshotsæ‰¹é‡æ›´æ–°)
- **ä¾èµ–**: Step 2.1
- **é£é™©**: ä½

#### Step 2.3: å•å…ƒæµ‹è¯•
- **ä»»åŠ¡**:
  - æµ‹è¯•ä¸åŒæ—¶é—´é—´éš”çš„åˆ†ç»„
  - æµ‹è¯•åº”ç”¨åˆ‡æ¢çš„åˆ†ç»„
  - æµ‹è¯•æœ€å¤§æ—¶é•¿æ‹†åˆ†
  - æµ‹è¯•æœ€å°æ—¶é•¿è¿‡æ»¤
- **ä¾èµ–**: Step 2.2
- **é£é™©**: ä½

---

### Phase 3: Markdownç”Ÿæˆå™¨ (2å¤©)

**ç›®æ ‡**: å°†ActivitySessionè½¬æ¢ä¸ºå¯è¯»çš„Markdownæ–‡ä»¶

#### Step 3.1: YAMLåºåˆ—åŒ–
- **æ–‡ä»¶**: `src/memory/markdown_generator.rs` (NEW)
- **ä»»åŠ¡**:
  - æ·»åŠ  `serde_yaml` ä¾èµ–
  - å®ç°frontmatteråºåˆ—åŒ–
  - å®ç°ISO 8601æ—¶é—´æ ¼å¼åŒ–
  - å®ç°åºå·ç”Ÿæˆé€»è¾‘ (æ¯æ—¥é‡ç½®)
- **ä¾èµ–**: Phase 1
- **é£é™©**: ä½

#### Step 3.2: AIæ€»ç»“ç”Ÿæˆ
- **æ–‡ä»¶**: `src/memory/markdown_generator.rs`
- **ä»»åŠ¡**:
  - è®¾è®¡æ€»ç»“promptæ¨¡æ¿
  - å®ç° `generate_ai_summary()` (è°ƒç”¨GPT-4)
  - å®ç° `generate_template_summary()` (fallback)
  - é”™è¯¯å¤„ç†å’Œé‡è¯•é€»è¾‘
- **ä¾èµ–**: Step 3.1
- **é£é™©**: ä¸­ (ä¾èµ–AIè´¨é‡å’ŒAPIç¨³å®šæ€§)

#### Step 3.3: æ–‡ä»¶å†™å…¥
- **æ–‡ä»¶**: `src/memory/markdown_generator.rs`
- **ä»»åŠ¡**:
  - å®ç°ç›®å½•åˆ›å»º
  - å®ç°æ–‡ä»¶å†™å…¥
  - å®ç°è·¯å¾„è¿”å›
- **ä¾èµ–**: Step 3.2
- **é£é™©**: ä½

---

### Phase 4: ç´¢å¼•ä¸æœç´¢ (3å¤©)

**ç›®æ ‡**: å®ç°æ–‡ä»¶ç›‘å¬ã€åˆ†å—ã€å‘é‡åŒ–å’Œæ··åˆæœç´¢

#### Step 4.1: æ–‡æœ¬åˆ†å—å™¨
- **æ–‡ä»¶**: `src/memory/chunker.rs` (NEW)
- **ä»»åŠ¡**:
  - å®ç° `chunk_markdown()` å‡½æ•°
  - å®ç°frontmatteræ£€æµ‹
  - å®ç°tokenä¼°ç®— (CJK + ASCII)
  - å®ç°overlapé€»è¾‘
  - å®ç° `hash_text()` (SHA-256)
- **ä¾èµ–**: æ— 
- **é£é™©**: ä¸­ (tokenä¼°ç®—å‡†ç¡®æ€§)

#### Step 4.2: æ–‡ä»¶ç›‘å¬å™¨
- **æ–‡ä»¶**: `src/memory/file_watcher.rs` (NEW)
- **ä»»åŠ¡**:
  - è¯„ä¼°polling vs `notify` crate
  - å®ç°æ–‡ä»¶å˜æ›´æ£€æµ‹
  - å®ç°å»æŠ–åŠ¨ (debounce)
- **ä¾èµ–**: æ— 
- **é£é™©**: ä½

#### Step 4.3: ç´¢å¼•ç®¡ç†å™¨
- **æ–‡ä»¶**: `src/memory/index_manager.rs` (NEW)
- **ä»»åŠ¡**:
  - å®ç° `scan_markdown_files()` (é€’å½’æ‰«æ)
  - å®ç° `compute_file_diff()` (å“ˆå¸Œå¯¹æ¯”)
  - å®ç° `index_file()` (åˆ†å—+embedding+å­˜å‚¨)
  - å®ç° `sync()` (å¢é‡åŒæ­¥)
  - é›†æˆembeddingç¼“å­˜
- **ä¾èµ–**: Steps 4.1, 4.2, Phase 1
- **é£é™©**: é«˜ (å¤æ‚åº¦é«˜ï¼Œé”™è¯¯å¤„ç†å…³é”®)

#### Step 4.4: æ··åˆæœç´¢å¼•æ“
- **æ–‡ä»¶**: `src/memory/hybrid_search.rs` (NEW)
- **ä»»åŠ¡**:
  - å®ç° `vector_search()` (æš´åŠ›cosineç›¸ä¼¼åº¦)
  - å®ç° `keyword_search()` (SQL LIKEæˆ–FTS5)
  - å®ç° `merge_results()` (åŠ æƒåˆå¹¶)
  - å®ç°æŒ‰activity_idèšåˆ
- **ä¾èµ–**: Step 4.3
- **é£é™©**: ä¸­ (æœç´¢è´¨é‡è°ƒä¼˜)

---

### Phase 5: ç®¡é“ç¼–æ’ (1å¤©)

**ç›®æ ‡**: æ•´åˆæ‰€æœ‰ç»„ä»¶åˆ°è‡ªåŠ¨åŒ–ç®¡é“

#### Step 5.1: é‡æ„Scheduler
- **æ–‡ä»¶**: `src/memory/scheduler.rs`
- **ä»»åŠ¡**:
  - è®¾è®¡æ–°çš„è°ƒåº¦å™¨æ¶æ„ (tokio::select!)
  - å®ç° `group_activities()` ä»»åŠ¡ (30åˆ†é’Ÿ)
  - å®ç° `sync_index()` ä»»åŠ¡ (10åˆ†é’Ÿ)
  - ä¿ç•™ç°æœ‰çš„ `analyze_screenshots()` (5åˆ†é’Ÿ)
  - æ·»åŠ  `generate_summaries()` ä»»åŠ¡ (24å°æ—¶)
- **ä¾èµ–**: Phases 2, 3, 4
- **é£é™©**: ä¸­ (å®šæ—¶å™¨åè°ƒ)

#### Step 5.2: åº”ç”¨å¯åŠ¨é›†æˆ
- **æ–‡ä»¶**: `src/lib.rs`
- **ä»»åŠ¡**:
  - åˆ›å»º `activities/` å’Œ `summaries/` ç›®å½•
  - åˆå§‹åŒ– `MemoryIndexManager`
  - å¯åŠ¨ `MemoryScheduler`
  - æ·»åŠ åˆ° `AppState`
- **ä¾èµ–**: Step 5.1
- **é£é™©**: ä½

---

### Phase 6: APIæ¥å£ (1å¤©)

**ç›®æ ‡**: æä¾›å‰ç«¯è°ƒç”¨çš„Tauriå‘½ä»¤

#### Step 6.1: å®šä¹‰å“åº”ç±»å‹
- **æ–‡ä»¶**: `src/commands/memory.rs`
- **ä»»åŠ¡**:
  - å®šä¹‰ `ActivitySearchResult`
  - å®šä¹‰ `ActivityDetail`
  - å®šä¹‰ `ScreenshotTimeline`
- **ä¾èµ–**: Phase 1
- **é£é™©**: ä½

#### Step 6.2: å®ç°æœç´¢å‘½ä»¤
- **æ–‡ä»¶**: `src/commands/memory.rs`
- **ä»»åŠ¡**:
  - `search_activities(query, limit)` - è¯­ä¹‰æœç´¢
  - `get_activity_detail(activity_id)` - è¯¦æƒ…+æˆªå›¾
  - `get_activities_by_date(start, end)` - æ—¥æœŸèŒƒå›´
  - `sync_memory_index()` - æ‰‹åŠ¨è§¦å‘åŒæ­¥
- **ä¾èµ–**: Phase 4, Step 6.1
- **é£é™©**: ä½

#### Step 6.3: æ³¨å†Œå‘½ä»¤
- **æ–‡ä»¶**: `src/lib.rs`
- **ä»»åŠ¡**: æ·»åŠ æ–°å‘½ä»¤åˆ° `invoke_handler`
- **ä¾èµ–**: Step 6.2
- **é£é™©**: ä½

---

### Phase 7: æ€»ç»“ç”Ÿæˆ (1å¤©)

**ç›®æ ‡**: å®ç°å‘¨/æœˆæ€»ç»“è‡ªåŠ¨ç”Ÿæˆ

#### Step 7.1: æ€»ç»“ç”Ÿæˆå™¨
- **æ–‡ä»¶**: `src/memory/summary_generator.rs` (NEW)
- **ä»»åŠ¡**:
  - å®ç° `generate_weekly_summary()`
  - å®ç° `generate_monthly_summary()`
  - è®¾è®¡æ€»ç»“Markdownæ ¼å¼
  - é›†æˆAIç”Ÿæˆé€»è¾‘
- **ä¾èµ–**: Phases 2, 3
- **é£é™©**: ä½

---

## APIè®¾è®¡

### å‰ç«¯è°ƒç”¨æ¥å£

#### 1. æœç´¢æ´»åŠ¨

```typescript
// Tauriå‘½ä»¤
invoke('search_activities', {
  query: 'ä»Šå¤©å†™äº†ä»€ä¹ˆä»£ç ',
  limit: 10
})

// å“åº”
{
  success: true,
  data: [
    {
      activity_id: 'activity-2024-01-15-001',
      title: 'ç¼–å†™Rustä»£ç å®ç°è®°å¿†ç³»ç»Ÿ',
      start_time: 1705318200,
      end_time: 1705322700,
      duration_minutes: 75,
      application: 'Visual Studio Code',
      category: 'ç¼–ç¨‹',
      tags: ['Rust', 'æ•°æ®åº“', 'è®°å¿†ç³»ç»Ÿ'],
      screenshot_count: 15,
      summary: 'ç”¨æˆ·åœ¨ä»Šå¤©ä¸‹åˆèŠ±äº†75åˆ†é’Ÿå®ç°...',
      markdown_path: 'activities/2024-01-15/activity-001.md',
      relevance_score: 0.87,
      matched_snippet: '...å®ç°Vision-Jarvisçš„è®°å¿†ç³»ç»Ÿæ ¸å¿ƒæ¨¡å—...'
    }
  ]
}
```

#### 2. è·å–æ´»åŠ¨è¯¦æƒ…

```typescript
invoke('get_activity_detail', {
  activity_id: 'activity-2024-01-15-001'
})

// å“åº”
{
  success: true,
  data: {
    activity: { /* ActivitySearchResult */ },
    screenshots: [
      {
        id: 'screenshot-001',
        timestamp: 1705318200,
        path: 'screenshots/2024-01-15/14-30-00.png',
        analysis: 'ç”¨æˆ·æ­£åœ¨ç¼–å†™Rustä»£ç ï¼Œæ–‡ä»¶åä¸ºmemory_index.rs'
      }
    ],
    full_markdown: '---\nid: ...\n---\n\n# ç¼–å†™Rustä»£ç ...'
  }
}
```

#### 3. æŒ‰æ—¥æœŸæŸ¥è¯¢

```typescript
invoke('get_activities_by_date', {
  start_date: '2024-01-15',
  end_date: '2024-01-16'  // å¯é€‰
})

// å“åº”: åŒsearch_activities
```

#### 4. æ‰‹åŠ¨åŒæ­¥ç´¢å¼•

```typescript
invoke('sync_memory_index')

// å“åº”
{
  success: true,
  data: {
    added: 3,
    modified: 1,
    deleted: 0
  }
}
```

### å‰ç«¯å±•ç¤ºå»ºè®®

#### æœç´¢ç»“æœå¡ç‰‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ ç¼–å†™Rustä»£ç å®ç°è®°å¿†ç³»ç»Ÿ                     â”‚
â”‚                                                 â”‚
â”‚ ğŸ• 14:30 - 15:45 (75åˆ†é’Ÿ)                       â”‚
â”‚ ğŸ’» Visual Studio Code                          â”‚
â”‚ ğŸ·ï¸ ç¼–ç¨‹ Â· Rust Â· æ•°æ®åº“                        â”‚
â”‚                                                 â”‚
â”‚ ç”¨æˆ·åœ¨ä»Šå¤©ä¸‹åˆèŠ±äº†75åˆ†é’Ÿå®ç°Vision-Jarvisçš„...  â”‚
â”‚                                                 â”‚
â”‚ ğŸ“¸ 15å¼ æˆªå›¾ | ç›¸å…³åº¦: 87%                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ´»åŠ¨è¯¦æƒ…é¡µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [è¿”å›] ç¼–å†™Rustï¿½ï¿½ï¿½ç å®ç°è®°å¿†ç³»ç»Ÿ                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚ ç”¨æˆ·åœ¨ä»Šå¤©ä¸‹åˆèŠ±äº†75åˆ†é’Ÿå®ç°Vision-Jarvisçš„è®°   â”‚
â”‚ å¿†ç³»ç»Ÿæ ¸å¿ƒæ¨¡å—ã€‚ä¸»è¦å·¥ä½œåŒ…æ‹¬ï¼š                   â”‚
â”‚                                                 â”‚
â”‚ 1. æ•°æ®åº“Schemaè®¾è®¡ - è®¾è®¡äº†activities...       â”‚
â”‚                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“¸ æˆªå›¾æ—¶é—´çº¿ (15å¼ )                             â”‚
â”‚                                                 â”‚
â”‚ 14:30 [ç¼©ç•¥å›¾] ç”¨æˆ·æ­£åœ¨ç¼–å†™Rustä»£ç ...          â”‚
â”‚ 14:35 [ç¼©ç•¥å›¾] ç”¨æˆ·åœ¨æŸ¥çœ‹SQLiteæ–‡æ¡£             â”‚
â”‚ 14:40 [ç¼©ç•¥å›¾] ç»§ç»­ç¼–å†™ä»£ç ï¼Œå®ç°æ•°æ®åº“æŸ¥è¯¢      â”‚
â”‚ ...                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## é£é™©ä¸ç¼“è§£

### é£é™©1: æ´»åŠ¨åˆ†ç»„è´¨é‡ (ä¸¥é‡æ€§: é«˜)

**é—®é¢˜æè¿°**:
- ç®€å•çš„å¯å‘å¼ç®—æ³•å¯èƒ½äº§ç”Ÿä¸å‡†ç¡®çš„åˆ†ç»„
- ç”¨æˆ·å¿«é€Ÿåˆ‡æ¢åº”ç”¨å¯¼è‡´è¿‡å¤šç¢ç‰‡åŒ–æ´»åŠ¨
- åŒä¸€åº”ç”¨å†…ä¸åŒä»»åŠ¡è¢«é”™è¯¯åˆå¹¶

**ç¼“è§£æªæ–½**:
1. **ä¿å®ˆçš„é»˜è®¤å‚æ•°**: 5åˆ†é’Ÿé—´éš”ã€æœ€å°‘2æˆªå›¾ã€æœ€é•¿2å°æ—¶
2. **ç”¨æˆ·å¯é…ç½®**: é€šè¿‡è®¾ç½®è°ƒæ•´æ‰€æœ‰é˜ˆå€¼
3. **Phase 2æ”¹è¿›**: å¼•å…¥embeddingç›¸ä¼¼åº¦åˆ¤æ–­æ´»åŠ¨ç›¸å…³æ€§
4. **æ‰‹åŠ¨è°ƒæ•´API**: æä¾›æ‹†åˆ†/åˆå¹¶æ´»åŠ¨çš„æ¥å£

**ä¼˜å…ˆçº§**: P0 (æ ¸å¿ƒä½“éªŒ)

---

### é£é™©2: AI APIæˆæœ¬ä¸å»¶è¿Ÿ (ä¸¥é‡æ€§: ä¸­)

**é—®é¢˜æè¿°**:
- æ¯ä¸ªæ´»åŠ¨éœ€è¦1æ¬¡GPT-4è°ƒç”¨(æ€»ç»“)
- æ¯ä¸ªæ´»åŠ¨éœ€è¦Næ¬¡embeddingè°ƒç”¨(åˆ†å—)
- æˆæœ¬å¯èƒ½å¿«é€Ÿç´¯ç§¯

**ç¼“è§£æªæ–½**:
1. **Embeddingç¼“å­˜**: ç›¸åŒæ–‡æœ¬æ°¸ä¸é‡å¤è®¡ç®—
2. **æ¨¡æ¿fallback**: AIä¸å¯ç”¨æ—¶ä½¿ç”¨æ¨¡æ¿ç”Ÿæˆ
3. **æ‰¹é‡embedding**: ä½¿ç”¨batch API(å¦‚æœ‰)
4. **é€Ÿç‡é™åˆ¶**: 100mså»¶è¿Ÿ + é‡è¯•æœºåˆ¶
5. **ç”¨æˆ·å¯é€‰**: å…è®¸ç¦ç”¨AIæ€»ç»“

**ä¼˜å…ˆçº§**: P1

---

### é£é™©3: æ–‡ä»¶ç³»ç»Ÿç´¯ç§¯ (ä¸¥é‡æ€§: ä¸­)

**é—®é¢˜æè¿°**:
- æ¯å¤©å¯èƒ½äº§ç”Ÿ20-50ä¸ªæ´»åŠ¨æ–‡ä»¶
- é•¿æœŸä½¿ç”¨å¯¼è‡´æ•°åƒä¸ªæ–‡ä»¶
- æœç´¢æ€§èƒ½å¯èƒ½ä¸‹é™

**ç¼“è§£æªæ–½**:
1. **æˆªå›¾å·²æœ‰é™åˆ¶**: `StorageManager` å·²å®ç°å¤§å°é™åˆ¶
2. **æ´»åŠ¨æ–‡ä»¶å°**: æ¯ä¸ª~2-5KBï¼Œ1000ä¸ªä»…5MB
3. **æ•°æ®åº“ç´¢å¼•**: æœç´¢ï¿½ï¿½éå†æ–‡ä»¶ï¼ŒåªæŸ¥DB
4. **å®šæœŸå½’æ¡£**: å®ç°ä¿ç•™ç­–ç•¥ (é»˜è®¤ä¿ç•™1å¹´)
5. **æ€»ç»“å‹ç¼©**: æ—§æ´»åŠ¨åˆå¹¶åˆ°å‘¨/æœˆæ€»ç»“åå¯åˆ é™¤

**ä¼˜å…ˆçº§**: P2

---

### é£é™©4: æ•°æ®åº“è¿ç§»å¤±è´¥ (ä¸¥é‡æ€§: ä¸­)

**é—®é¢˜æè¿°**:
- ç°æœ‰ç”¨æˆ·çš„V1æ•°æ®åº“éœ€è¦å‡çº§
- ALTER TABLEå¯èƒ½åœ¨æŸäº›SQLiteç‰ˆæœ¬å¤±è´¥
- æ•°æ®ä¸¢å¤±é£é™©

**ç¼“è§£æªæ–½**:
1. **ç‰ˆæœ¬è¿½è¸ª**: `schema_meta` è¡¨ç²¾ç¡®æ§åˆ¶è¿ç§»
2. **éç ´åæ€§**: åªæ·»åŠ è¡¨å’Œåˆ—ï¼Œä¸åˆ é™¤
3. **å­˜åœ¨æ€§æ£€æŸ¥**: `CREATE IF NOT EXISTS`, `pragma_table_info`
4. **å¤‡ä»½æç¤º**: å‡çº§å‰æç¤ºç”¨æˆ·å¤‡ä»½
5. **å›æ»šæœºåˆ¶**: å¤±è´¥æ—¶æ¢å¤åˆ°V1

**ä¼˜å…ˆçº§**: P0 (æ•°æ®å®‰å…¨)

---

### é£é™©5: æœç´¢è´¨é‡ä¸ä½³ (ä¸¥é‡æ€§: ä¸­)

**é—®é¢˜æè¿°**:
- å‘é‡æœç´¢å¯èƒ½è¿”å›ä¸ç›¸å…³ç»“æœ
- BM25å…³é”®è¯åŒ¹é…å¯èƒ½è¿‡äºç®€å•
- æƒé‡é…ç½®å¯èƒ½ä¸é€‚åˆä¸­æ–‡

**ç¼“è§£æªæ–½**:
1. **ç»§æ‰¿OpenClawå‚æ•°**: 70/30æƒé‡å·²éªŒè¯
2. **å¯è°ƒé…ç½®**: å…è®¸è°ƒæ•´æƒé‡
3. **FTS5æ”¯æŒ**: åç»­å‡çº§åˆ°çœŸæ­£çš„BM25
4. **ç”¨æˆ·åé¦ˆ**: è®°å½•æœç´¢ç‚¹å‡»ç‡ï¼Œè¿­ä»£ä¼˜åŒ–
5. **æ··åˆç­–ç•¥**: å‘é‡æ•è·è¯­ä¹‰ï¼Œå…³é”®è¯æ•è·ç²¾ç¡®åŒ¹é…

**ä¼˜å…ˆçº§**: P1

---

## æˆåŠŸæ ‡å‡†

å®Œæˆå®æ–½åï¼Œç³»ç»Ÿåº”æ»¡è¶³ä»¥ä¸‹æ ‡å‡†ï¼š

### åŠŸèƒ½æ€§

- âœ… å·²åˆ†æçš„æˆªå›¾æ¯30åˆ†é’Ÿè‡ªåŠ¨èšåˆä¸ºæ´»åŠ¨ä¼šè¯
- âœ… æ¯ä¸ªæ´»åŠ¨ç”Ÿæˆæ ¼å¼æ­£ç¡®çš„Markdownæ–‡ä»¶(å«YAML frontmatter)
- âœ… Markdownæ–‡ä»¶è‡ªåŠ¨ç´¢å¼•ï¼Œæ”¯æŒå¢é‡æ›´æ–°
- âœ… æ··åˆæœç´¢è¿”å›æŒ‰æ´»åŠ¨èšåˆçš„ç»“æœï¼Œç›¸å…³åº¦è¯„åˆ†åˆç†
- âœ… ç”¨æˆ·æœç´¢"ä»Šå¤©å†™äº†ä»€ä¹ˆä»£ç "èƒ½è·å¾—åŒ…å«æˆªå›¾æ—¶é—´çº¿çš„å®Œæ•´ç­”æ¡ˆ
- âœ… å‘¨/æœˆæ€»ç»“è‡ªåŠ¨ç”Ÿæˆ

### å…¼å®¹æ€§

- âœ… ç°æœ‰æˆªå›¾é‡‡é›†å’Œåˆ†æåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… V1â†’V2æ•°æ®åº“è¿ç§»æˆåŠŸï¼Œæ— æ•°æ®ä¸¢å¤±
- âœ… å‰ç«¯APIå‘åå…¼å®¹(å¯é€‰)

### æ€§èƒ½

- âœ… 1000+ æˆªå›¾/å¤©ç³»ç»Ÿæ— æ˜æ˜¾æ€§èƒ½ä¸‹é™
- âœ… æœç´¢å“åº”æ—¶é—´ < 500ms (10k chunks)
- âœ… Embeddingç¼“å­˜å‘½ä¸­ç‡ > 80%

### è´¨é‡

- âœ… æ´»åŠ¨åˆ†ç»„å‡†ç¡®ç‡ > 85% (äººå·¥è¯„ä¼°)
- âœ… AIæ€»ç»“å¯è¯»æ€§è‰¯å¥½ï¼Œæ— æ˜æ˜¾é”™è¯¯
- âœ… æ‰€æœ‰æ–°æ¨¡å—å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
- âœ… é›†æˆæµ‹è¯•è¦†ç›–ä¸»è¦æ•°æ®æµ

---

## é™„å½•

### ä¾èµ–åº“æ¸…å•

```toml
# Cargo.toml æ–°å¢ä¾èµ–
[dependencies]
serde_yaml = "0.9"          # YAML frontmatteråºåˆ—åŒ–
sha2 = "0.10"               # æ–‡ä»¶å“ˆå¸Œè®¡ç®—

# å¯é€‰ (æ–‡ä»¶ç›‘å¬)
notify = { version = "6", features = ["macos_fsevent"] }
```

### å…³é”®æ–‡ä»¶æ¸…å•

| # | è·¯å¾„ | ç±»å‹ | è¯´æ˜ |
|---|------|------|------|
| 1 | `src/db/schema.rs` | ä¿®æ”¹ | æ·»åŠ ï¿½ï¿½ï¿½ç±»å‹å®šä¹‰ |
| 2 | `src/db/migrations.rs` | ä¿®æ”¹ | V2è¿ç§»é€»è¾‘ |
| 3 | `src/memory/activity_grouper.rs` | æ–°å»º | æ ¸å¿ƒåˆ†ç»„ç®—æ³• |
| 4 | `src/memory/markdown_generator.rs` | æ–°å»º | Markdownç”Ÿæˆ |
| 5 | `src/memory/chunker.rs` | æ–°å»º | æ–‡æœ¬åˆ†å— |
| 6 | `src/memory/index_manager.rs` | æ–°å»º | ç´¢å¼•ç®¡ç†å™¨ |
| 7 | `src/memory/hybrid_search.rs` | æ–°å»º | æ··åˆæœç´¢ |
| 8 | `src/memory/file_watcher.rs` | æ–°å»º | æ–‡ä»¶ç›‘å¬ |
| 9 | `src/memory/summary_generator.rs` | æ–°å»º | æ€»ç»“ç”Ÿæˆ |
| 10 | `src/memory/scheduler.rs` | é‡æ„ | ç®¡é“ç¼–æ’ |
| 11 | `src/commands/memory.rs` | é‡æ„ | APIæ¥å£ |
| 12 | `src/lib.rs` | ä¿®æ”¹ | å¯åŠ¨é›†æˆ |

æ‰€æœ‰è·¯å¾„åŸºäº: `/Users/lettery/Documents/code/Vision-Jarvis/worktrees/back-build/vision-jarvis/src-tauri/`

### å‚è€ƒèµ„æ–™

- [OpenClaw è®°å¿†ç®¡ç†ç³»ç»Ÿæ·±åº¦è§£æ](./OpenClawè®°å¿†ç®¡ç†ç³»ç»Ÿæ·±åº¦è§£æ.md)
- [rusqlite æ–‡æ¡£](https://docs.rs/rusqlite/)
- [serde_yaml æ–‡æ¡£](https://docs.rs/serde_yaml/)
- [OpenAI Embeddings API](https://platform.openai.com/docs/guides/embeddings)

---

**æ–‡æ¡£ç»´æŠ¤**:
- åˆ›å»º: 2025-01-15
- æœ€åæ›´æ–°: 2025-01-15
- è´Ÿè´£äºº: Vision-Jarvis å¼€å‘å›¢é˜Ÿ
