# Popup-Setting é¡µé¢ (æé†’è®¾ç½®)

> **é¡µé¢è·¯ç”±**: `/popup-setting`
> **é¡µé¢æ–‡ä»¶**: `src/pages/popup-setting.astro`
> **çŠ¶æ€**: ğŸš§ å¼€å‘ä¸­
> **æœ€åæ›´æ–°**: 2026-02-04

---

## ğŸ“‹ æ¦‚è¿°

Popup-Setting é¡µé¢ç”¨äºé…ç½® Vision-Jarvis çš„å„ç±»æé†’åŠŸèƒ½,åŒ…æ‹¬å¯åŠ¨æé†’ã€å®šæ—¶æé†’å’Œæ— å˜åŒ–æé†’ã€‚é‡‡ç”¨**å¡ç‰‡ç»„ä»¶**çš„å¸ƒå±€å½¢å¼,æ”¯æŒåç»­æ‰©å±•æ›´å¤šè®¾ç½®é¡¹ã€‚

---

## ğŸ¨ é¡µé¢å¸ƒå±€

### æ•´ä½“è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Popup-Setting é¡µé¢å¸ƒå±€                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš™ï¸ æé†’è®¾ç½®                                   [è¿”å›] â”‚ â† Header
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  ğŸš€ å¯åŠ¨è®¾ç½®      â”‚  â”‚  â° å®šæ—¶æé†’      â”‚       â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚       â”‚
â”‚  â”‚  [å¼€å…³]          â”‚  â”‚  [å¼€å…³]          â”‚       â”‚
â”‚  â”‚  å¯åŠ¨æ–‡æœ¬è¾“å…¥æ¡†   â”‚  â”‚  æ—¶é—´èŒƒå›´é€‰æ‹©     â”‚       â”‚
â”‚  â”‚                  â”‚  â”‚  é—´éš”è®¾ç½®        â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  ğŸ’¤ æ— å˜åŒ–æé†’    â”‚  â”‚  â• å…¶ä»–è®¾ç½®      â”‚       â”‚
â”‚  â”‚                  â”‚  â”‚  (å¾…æ‰©å±•)        â”‚       â”‚
â”‚  â”‚  [å¼€å…³]          â”‚  â”‚                  â”‚       â”‚
â”‚  â”‚  æ—¶é•¿è®¾ç½®        â”‚  â”‚                  â”‚       â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¸ƒå±€:
- Grid å¸ƒå±€: 2 åˆ—ï¼ˆå“åº”å¼ï¼‰
- å¡ç‰‡é—´è·: 24px
- å¡ç‰‡åœ†è§’: 12px
- å¡ç‰‡é˜´å½±: 0 2px 8px rgba(0,0,0,0.1)
```

---

## ğŸ—ï¸ é¡µé¢ç»“æ„

### Astro é¡µé¢æ–‡ä»¶

```astro
---
// src/pages/popup-setting.astro
import Layout from '@/layouts/Layout.astro';
import SettingCard from '@/components/settings/SettingCard';
import StartupSetting from '@/components/settings/StartupSetting';
import TimedReminderSetting from '@/components/settings/TimedReminderSetting';
import IdleReminderSetting from '@/components/settings/IdleReminderSetting';
---

<Layout title="æé†’è®¾ç½® - Vision-Jarvis">
  <div class="setting-page">
    <!-- Header -->
    <header class="setting-header">
      <h1 class="setting-title">âš™ï¸ æé†’è®¾ç½®</h1>
      <button
        onclick="window.history.back()"
        class="back-btn"
      >
        è¿”å›
      </button>
    </header>

    <!-- è®¾ç½®å¡ç‰‡ç½‘æ ¼ -->
    <div class="setting-grid">
      <!-- å¯åŠ¨è®¾ç½®å¡ç‰‡ -->
      <StartupSetting client:load />

      <!-- å®šæ—¶æé†’å¡ç‰‡ -->
      <TimedReminderSetting client:load />

      <!-- æ— å˜åŒ–æé†’å¡ç‰‡ -->
      <IdleReminderSetting client:load />

      <!-- é¢„ç•™æ‰©å±•å¡ç‰‡ -->
      <SettingCard
        title="â• æ›´å¤šè®¾ç½®"
        description="å³å°†æ¨å‡ºæ›´å¤šåŠŸèƒ½"
        client:visible
      >
        <p class="text-gray-500 text-sm">æ•¬è¯·æœŸå¾…...</p>
      </SettingCard>
    </div>
  </div>
</Layout>

<style>
  .setting-page {
    min-height: 100vh;
    background: #f9fafb;
    padding: 24px;
  }

  .setting-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 32px;
  }

  .setting-title {
    font-size: 1.875rem;
    font-weight: 700;
    color: #111827;
  }

  .back-btn {
    padding: 8px 16px;
    border-radius: 8px;
    border: 1px solid #d1d5db;
    background: #ffffff;
    cursor: pointer;
    transition: all 0.2s;
  }

  .back-btn:hover {
    background: #f3f4f6;
    border-color: #9ca3af;
  }

  .setting-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 24px;
  }

  @media (max-width: 768px) {
    .setting-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
```

---

## ğŸ“¦ è®¾ç½®å¡ç‰‡ç»„ä»¶

### SettingCard åŸºç¡€ç»„ä»¶

```typescript
// components/settings/SettingCard.tsx
import { motion } from 'framer-motion';
import type { FC, ReactNode } from 'react';

interface SettingCardProps {
  title: string;
  description?: string;
  icon?: string;
  children: ReactNode;
  className?: string;
}

export const SettingCard: FC<SettingCardProps> = ({
  title,
  description,
  icon,
  children,
  className = ''
}) => {
  return (
    <motion.div
      className={`setting-card ${className}`}
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.3 }}
      style={{
        background: '#ffffff',
        borderRadius: '12px',
        padding: '24px',
        boxShadow: '0 2px 8px rgba(0, 0, 0, 0.1)'
      }}
    >
      <div className="card-header">
        <h3 className="card-title">
          {icon && <span className="card-icon">{icon}</span>}
          {title}
        </h3>
        {description && (
          <p className="card-description">{description}</p>
        )}
      </div>

      <div className="card-content">
        {children}
      </div>
    </motion.div>
  );
};
```

---

## ğŸš€ å¯åŠ¨è®¾ç½®å¡ç‰‡

```typescript
// components/settings/StartupSetting.tsx
import { useStore } from '@nanostores/react';
import { settings } from '@/stores/settingStore';
import { SettingCard } from './SettingCard';
import { ToggleSwitch } from '@/components/ui/ToggleSwitch';
import { Input } from '@/components/ui/Input';

export function StartupSetting() {
  const currentSettings = useStore(settings);

  const handleToggleAutoStart = async (enabled: boolean) => {
    settings.setKey('autoStart', enabled);

    // è°ƒç”¨ Tauri åç«¯è®¾ç½®å¼€æœºå¯åŠ¨
    await invoke('set_auto_start', { enabled });
  };

  const handleUpdateMessage = (message: string) => {
    settings.setKey('startupMessage', message);
  };

  return (
    <SettingCard
      title="ğŸš€ å¯åŠ¨è®¾ç½®"
      description="é…ç½®åº”ç”¨å¯åŠ¨è¡Œä¸º"
    >
      <div className="setting-group">
        {/* å¼€æœºè‡ªåŠ¨å¯åŠ¨å¼€å…³ */}
        <div className="setting-item">
          <ToggleSwitch
            enabled={currentSettings.autoStart}
            onChange={handleToggleAutoStart}
            label="å¼€æœºè‡ªåŠ¨å¯åŠ¨"
          />
          <p className="setting-hint">
            å¯ç”¨åï¼Œåº”ç”¨å°†åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œ
          </p>
        </div>

        {/* å¯åŠ¨å¼¹å‡ºæ–‡æœ¬è®¾ç½® */}
        <div className="setting-item">
          <label className="setting-label">å¯åŠ¨æç¤ºæ–‡æœ¬</label>
          <Input
            type="textarea"
            value={currentSettings.startupMessage}
            onChange={handleUpdateMessage}
            placeholder="If today were the last day of my life..."
            rows={3}
          />
          <p className="setting-hint">
            åº”ç”¨å¯åŠ¨æ—¶æ˜¾ç¤ºçš„æ¿€åŠ±æ–‡æœ¬
          </p>
        </div>
      </div>
    </SettingCard>
  );
}
```

---

## â° å®šæ—¶æé†’å¡ç‰‡

```typescript
// components/settings/TimedReminderSetting.tsx
import { useStore } from '@nanostores/react';
import { settings } from '@/stores/settingStore';
import { SettingCard } from './SettingCard';
import { ToggleSwitch } from '@/components/ui/ToggleSwitch';
import { TimeRangePicker } from '@/components/ui/TimeRangePicker';
import { Input } from '@/components/ui/Input';

export function TimedReminderSetting() {
  const currentSettings = useStore(settings);
  const { enabled, timeRange, interval } = currentSettings.timedReminder;

  return (
    <SettingCard
      title="â° å®šæ—¶æé†’"
      description="è®¾ç½®å®šæ—¶æé†’è§„åˆ™"
    >
      <div className="setting-group">
        {/* åŠŸèƒ½å¼€å…³ */}
        <div className="setting-item">
          <ToggleSwitch
            enabled={enabled}
            onChange={(value) => {
              settings.setKey('timedReminder.enabled', value);
            }}
            label="å¯ç”¨å®šæ—¶æé†’"
          />
        </div>

        {/* æ—¶é—´èŒƒå›´é€‰æ‹© */}
        {enabled && (
          <>
            <div className="setting-item">
              <label className="setting-label">æé†’æ—¶é—´èŒƒå›´</label>
              <TimeRangePicker
                start={timeRange.start}
                end={timeRange.end}
                onChange={(start, end) => {
                  settings.setKey('timedReminder.timeRange', { start, end });
                }}
              />
              <p className="setting-hint">
                åœ¨æ­¤æ—¶é—´æ®µå†…æ¯éš”ä¸€å®šæ—¶é—´æé†’ä¸€æ¬¡
              </p>
            </div>

            {/* é—´éš”æ—¶é•¿è®¾ç½® */}
            <div className="setting-item">
              <label className="setting-label">æé†’é—´éš”</label>
              <div className="flex items-center gap-2">
                <Input
                  type="number"
                  value={interval}
                  onChange={(value) => {
                    settings.setKey('timedReminder.interval', Number(value));
                  }}
                  min={1}
                  max={120}
                  className="w-24"
                />
                <span className="text-gray-600">åˆ†é’Ÿ</span>
              </div>
              <p className="setting-hint">
                æ¯éš” {interval} åˆ†é’Ÿæé†’ä¸€æ¬¡
              </p>
            </div>
          </>
        )}
      </div>
    </SettingCard>
  );
}
```

---

## ğŸ’¤ æ— å˜åŒ–æé†’å¡ç‰‡

```typescript
// components/settings/IdleReminderSetting.tsx
import { useStore } from '@nanostores/react';
import { settings } from '@/stores/settingStore';
import { SettingCard } from './SettingCard';
import { ToggleSwitch } from '@/components/ui/ToggleSwitch';
import { Input } from '@/components/ui/Input';

export function IdleReminderSetting() {
  const currentSettings = useStore(settings);
  const { enabled, idleThreshold } = currentSettings.idleReminder;

  return (
    <SettingCard
      title="ğŸ’¤ æ— å˜åŒ–æé†’"
      description="å±å¹•æ— æ“ä½œæ—¶çš„æé†’è®¾ç½®"
    >
      <div className="setting-group">
        {/* åŠŸèƒ½å¼€å…³ */}
        <div className="setting-item">
          <ToggleSwitch
            enabled={enabled}
            onChange={(value) => {
              settings.setKey('idleReminder.enabled', value);
            }}
            label="å¯ç”¨æ— å˜åŒ–æé†’"
          />
        </div>

        {/* æ— å˜åŒ–æ—¶é•¿åˆ¤æ–­ */}
        {enabled && (
          <div className="setting-item">
            <label className="setting-label">æ— å˜åŒ–åˆ¤æ–­æ—¶é•¿</label>
            <div className="flex items-center gap-2">
              <Input
                type="number"
                value={idleThreshold}
                onChange={(value) => {
                  settings.setKey('idleReminder.idleThreshold', Number(value));
                }}
                min={1}
                max={60}
                className="w-24"
              />
              <span className="text-gray-600">åˆ†é’Ÿ</span>
            </div>
            <p className="setting-hint">
              å±å¹• {idleThreshold} åˆ†é’Ÿå†…æ— å˜åŒ–æ—¶è®¤ä¸ºç”¨æˆ·ç¦»å¼€ï¼Œè§¦å‘æé†’
            </p>
          </div>
        )}
      </div>
    </SettingCard>
  );
}
```

---

## ğŸ”— çŠ¶æ€ç®¡ç†

### Nanostores å®šä¹‰

```typescript
// stores/settingStore.ts
import { map } from 'nanostores';
import { invoke } from '@tauri-apps/api/core';

export const settings = map({
  // å¯åŠ¨è®¾ç½®
  autoStart: true,
  startupMessage: "If today were the last day of my life, would I want to do what I am about to do today?",

  // å®šæ—¶æé†’
  timedReminder: {
    enabled: false,
    timeRange: { start: '09:00', end: '21:00' },
    interval: 30 // åˆ†é’Ÿ
  },

  // æ— å˜åŒ–æé†’
  idleReminder: {
    enabled: false,
    idleThreshold: 15 // åˆ†é’Ÿ
  },

  // æˆªå±è®¾ç½®
  screenshot: {
    frequency: 5, // ç§’
    storagePath: '/default/path',
    maxSize: 1024 // MB
  }
});

// åˆå§‹åŒ–è®¾ç½®ï¼ˆä»åç«¯åŠ è½½ï¼‰
export async function loadSettings() {
  try {
    const savedSettings = await invoke<typeof settings>('get_settings');
    settings.set(savedSettings);
  } catch (error) {
    console.error('Failed to load settings:', error);
  }
}

// ä¿å­˜è®¾ç½®åˆ°åç«¯
export async function saveSettings() {
  try {
    await invoke('save_settings', { settings: settings.get() });
  } catch (error) {
    console.error('Failed to save settings:', error);
  }
}

// ç›‘å¬è®¾ç½®å˜åŒ–ï¼Œè‡ªåŠ¨ä¿å­˜
settings.subscribe((value) => {
  saveSettings();
});
```

---

## ğŸ¨ UI ç»„ä»¶

### TimeRangePicker ç»„ä»¶

```typescript
// components/ui/TimeRangePicker.tsx
interface TimeRangePickerProps {
  start: string;
  end: string;
  onChange: (start: string, end: string) => void;
}

export function TimeRangePicker({ start, end, onChange }: TimeRangePickerProps) {
  return (
    <div className="time-range-picker">
      <input
        type="time"
        value={start}
        onChange={(e) => onChange(e.target.value, end)}
        className="time-input"
      />
      <span className="separator">è‡³</span>
      <input
        type="time"
        value={end}
        onChange={(e) => onChange(start, e.target.value)}
        className="time-input"
      />
    </div>
  );
}
```

---

## ğŸ“± å“åº”å¼è®¾è®¡

```css
/* ç§»åŠ¨ç«¯é€‚é… */
@media (max-width: 768px) {
  .setting-page {
    padding: 16px;
  }

  .setting-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 16px;
  }

  .setting-grid {
    grid-template-columns: 1fr;
    gap: 16px;
  }

  .setting-card {
    padding: 16px;
  }
}
```

---

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

```typescript
// pages/popup-setting.test.tsx
import { render, screen, fireEvent } from '@testing-library/react';
import PopupSettingPage from './popup-setting.astro';

describe('Popup Setting Page', () => {
  it('renders all setting cards', () => {
    render(<PopupSettingPage />);

    expect(screen.getByText('å¯åŠ¨è®¾ç½®')).toBeInTheDocument();
    expect(screen.getByText('å®šæ—¶æé†’')).toBeInTheDocument();
    expect(screen.getByText('æ— å˜åŒ–æé†’')).toBeInTheDocument();
  });

  it('toggles auto start', async () => {
    render(<PopupSettingPage />);

    const toggle = screen.getByLabelText('å¼€æœºè‡ªåŠ¨å¯åŠ¨');
    fireEvent.click(toggle);

    // éªŒè¯çŠ¶æ€æ›´æ–°
    expect(settings.get().autoStart).toBe(false);
  });
});
```

---

## ğŸ“ å¾…å®ç°åŠŸèƒ½

- [ ] æé†’éŸ³æ•ˆé€‰æ‹©
- [ ] æé†’æ ·å¼è‡ªå®šä¹‰
- [ ] æé†’å†å²è®°å½•
- [ ] æ‰¹é‡å¯¼å…¥/å¯¼å‡ºè®¾ç½®
- [ ] è®¾ç½®é¢„è®¾æ¨¡æ¿
- [ ] æé†’æµ‹è¯•åŠŸèƒ½

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [SettingCard ç»„ä»¶](../components/SettingCard.md)
- [ToggleSwitch ç»„ä»¶](../components/ToggleSwitch.md)
- [TimeRangePicker ç»„ä»¶](../components/TimeRangePicker.md)
- [çŠ¶æ€ç®¡ç†](../state-management.md)

---

**é¡µé¢ç»´æŠ¤è€…**: å‰ç«¯å›¢é˜Ÿ
**æœ€åæ›´æ–°**: 2026-02-04
