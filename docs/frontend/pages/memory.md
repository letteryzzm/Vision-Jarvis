# Memory é¡µé¢ (è®°å¿†ç®¡ç†)

> **é¡µé¢è·¯ç”±**: `/memory`
> **é¡µé¢æ–‡ä»¶**: `src/pages/memory.astro`
> **çŠ¶æ€**: ğŸš§ å¼€å‘ä¸­
> **æœ€åæ›´æ–°**: 2026-02-04

---

## ğŸ“‹ æ¦‚è¿°

Memory é¡µé¢æ˜¯ Vision-Jarvis çš„æ ¸å¿ƒåŠŸèƒ½é¡µé¢,ç”¨äºæŸ¥çœ‹ã€ç®¡ç†å’Œæ£€ç´¢ç”¨æˆ·çš„çŸ­æœŸå’Œé•¿æœŸè®°å¿†ã€‚é‡‡ç”¨**å·¦ä¾§ Sidebar + å³ä¾§ä¸»å†…å®¹**çš„ç»å…¸å¸ƒå±€ã€‚

---

## ğŸ¨ é¡µé¢å¸ƒå±€

### æ•´ä½“è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Memory é¡µé¢å¸ƒå±€                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚                                         â”‚
â”‚             â”‚  ğŸ” æœç´¢æ¡†/é—®ç­”æ¡†                        â”‚
â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  Left       â”‚  â”‚ æƒ³æ‰¾å“ªæ®µè®°å¿†ï¼Œæˆ‘éƒ½è®°ç€å‘¢éšä¾¿é—®    â”‚  â”‚
â”‚  Sidebar    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                                         â”‚
â”‚  280px      â”‚                                         â”‚
â”‚             â”‚  ğŸ“‹ è®°å¿†å¡ç‰‡ / æ€»ç»“å†…å®¹                  â”‚
â”‚  - å¼€å…³     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  - æ—¥æœŸé€‰æ‹©  â”‚  â”‚ äº‹é¡¹æ ‡é¢˜: å›¢é˜Ÿæ™¨ä¼š                â”‚  â”‚
â”‚  - è®°å¿†åˆ—è¡¨  â”‚  â”‚ æ—¶é—´: 09:00-10:00               â”‚  â”‚
â”‚  - æˆªå±è®¾ç½®  â”‚  â”‚ å†…å®¹: ...                       â”‚  â”‚
â”‚             â”‚  â”‚ å»ºè®®: ...                       â”‚  â”‚
â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   Sidebar          Main Content (flex-1)
```

---

## ğŸ—ï¸ é¡µé¢ç»“æ„

### Astro é¡µé¢æ–‡ä»¶

```astro
---
// src/pages/memory.astro
import Layout from '@/layouts/Layout.astro';
import MemorySidebar from '@/components/memory/MemorySidebar';
import MemoryContent from '@/components/memory/MemoryContent';
import FloatingInput from '@/components/FloatingInput';
---

<Layout title="è®°å¿†ç®¡ç† - Vision-Jarvis">
  <div class="memory-page">
    <!-- å·¦ä¾§ Sidebar -->
    <aside class="memory-sidebar">
      <MemorySidebar client:load />
    </aside>

    <!-- å³ä¾§ä¸»å†…å®¹ -->
    <main class="memory-content">
      <FloatingInput
        client:load
        placeholder="æƒ³æ‰¾å“ªæ®µè®°å¿†ï¼Œæˆ‘éƒ½è®°ç€å‘¢éšä¾¿é—®"
        className="memory-search"
      />

      <MemoryContent client:visible />
    </main>
  </div>
</Layout>

<style>
  .memory-page {
    display: flex;
    height: 100vh;
    background: #f9fafb;
  }

  .memory-sidebar {
    width: 280px;
    border-right: 1px solid #e5e7eb;
    background: #ffffff;
    overflow-y: auto;
  }

  .memory-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .memory-search {
    position: sticky;
    top: 0;
    z-index: 10;
  }
</style>
```

---

## ğŸ“¦ å·¦ä¾§ Sidebar ç»„ä»¶

### MemorySidebar ç»“æ„

```typescript
// components/memory/MemorySidebar.tsx
import { useState } from 'react';
import { useStore } from '@nanostores/react';
import { memoryEnabled, shortTermMemories } from '@/stores/memoryStore';
import { ToggleSwitch } from '@/components/ui/ToggleSwitch';
import { DatePicker } from '@/components/DatePicker';
import { MemoryList } from '@/components/MemoryList';
import { ScreenshotSettings } from './ScreenshotSettings';

export function MemorySidebar() {
  const isMemoryEnabled = useStore(memoryEnabled);
  const memories = useStore(shortTermMemories);
  const [selectedDate, setSelectedDate] = useState(new Date());

  return (
    <div className="sidebar-container">
      {/* 1. è®°å¿†åŠŸèƒ½å¼€å…³ */}
      <section className="sidebar-section">
        <h3 className="sidebar-title">ï¿½ï¿½ï¿½å¿†åŠŸèƒ½</h3>
        <ToggleSwitch
          enabled={isMemoryEnabled}
          onChange={(enabled) => memoryEnabled.set(enabled)}
          label="å¯ç”¨å…¨å±€è®°å¿†"
        />
      </section>

      {/* 2. æ—¥æœŸé€‰æ‹©å™¨ */}
      <section className="sidebar-section">
        <h3 className="sidebar-title">æ—¥æœŸé€‰æ‹©</h3>
        <DatePicker
          value={selectedDate}
          onChange={setSelectedDate}
          mode="single" // å•æ—¥æœŸæ¨¡å¼
        />
        <button
          onClick={() => {
            // è§¦å‘æ—¥æœŸèŒƒå›´é€‰æ‹©
            openDateRangeModal();
          }}
          className="date-range-btn"
        >
          é€‰æ‹©æ—¥æœŸèŒƒå›´åˆ†æ
        </button>
      </section>

      {/* 3. çŸ­æœŸè®°å¿†åˆ—è¡¨ */}
      <section className="sidebar-section flex-1">
        <h3 className="sidebar-title">è®°å¿†äº‹é¡¹</h3>
        <MemoryList
          date={selectedDate}
          memories={memories.get().items}
        />
      </section>

      {/* 4. æˆªå±è®¾ç½® */}
      <section className="sidebar-section">
        <ScreenshotSettings />
      </section>
    </div>
  );
}
```

### æ—¥æœŸé€‰æ‹©å™¨

```typescript
// components/DatePicker/DatePicker.tsx
interface DatePickerProps {
  value: Date;
  onChange: (date: Date) => void;
  mode: 'single' | 'range';
}

export function DatePicker({ value, onChange, mode }: DatePickerProps) {
  return (
    <div className="date-picker">
      <input
        type="date"
        value={formatDate(value)}
        onChange={(e) => onChange(new Date(e.target.value))}
        className="date-input"
      />
      {/* ä½¿ç”¨ç¬¬ä¸‰æ–¹æ—¥å†ç»„ä»¶å¦‚ react-day-picker */}
    </div>
  );
}
```

### çŸ­æœŸè®°å¿†åˆ—è¡¨

```typescript
// components/MemoryList/MemoryList.tsx
interface MemoryListProps {
  date: Date;
  memories: ShortTermMemory[];
}

export function MemoryList({ date, memories }: MemoryListProps) {
  // æŒ‰æ—¶é—´æ®µåˆ†ç»„
  const groupedMemories = groupByTimeOfDay(memories);

  return (
    <div className="memory-list">
      {/* æ—©æ™¨ (06:00-12:00) */}
      {groupedMemories.morning.length > 0 && (
        <div className="time-group">
          <div className="time-divider">æ—©æ™¨</div>
          {groupedMemories.morning.map((memory) => (
            <MemoryListItem key={memory.id} memory={memory} />
          ))}
        </div>
      )}

      {/* ä¸‹åˆ (12:00-18:00) */}
      {groupedMemories.afternoon.length > 0 && (
        <div className="time-group">
          <div className="time-divider">ä¸‹åˆ</div>
          {groupedMemories.afternoon.map((memory) => (
            <MemoryListItem key={memory.id} memory={memory} />
          ))}
        </div>
      )}

      {/* æ™šä¸Š (18:00-24:00) */}
      {groupedMemories.evening.length > 0 && (
        <div className="time-group">
          <div className="time-divider">æ™šä¸Š</div>
          {groupedMemories.evening.map((memory) => (
            <MemoryListItem key={memory.id} memory={memory} />
          ))}
        </div>
      )}
    </div>
  );
}

// è®°å¿†åˆ—è¡¨é¡¹
function MemoryListItem({ memory }: { memory: ShortTermMemory }) {
  return (
    <button
      className="memory-list-item"
      onClick={() => {
        // åˆ‡æ¢å³ä¾§æ˜¾ç¤ºè¯¥äº‹é¡¹è¯¦æƒ…
        selectedMemory.set(memory);
      }}
    >
      <div className="item-time">{memory.timeRange}</div>
      <div className="item-title">{memory.title}</div>
    </button>
  );
}
```

### æˆªå±è®¾ç½®

```typescript
// components/memory/ScreenshotSettings.tsx
import { SliderInput } from '@/components/ui/SliderInput';
import { settings } from '@/stores/settingStore';

export function ScreenshotSettings() {
  const screenshotFrequency = settings.get().screenshot.frequency;

  return (
    <div className="screenshot-settings">
      <h4 className="setting-title">æˆªå±è®¾ç½®</h4>

      {/* æˆªå±é¢‘ç‡æ»‘åŠ¨æ¡ */}
      <SliderInput
        label="æˆªå±é¢‘ç‡"
        value={screenshotFrequency}
        min={1}
        max={15}
        step={1}
        unit="ç§’"
        onChange={(value) => {
          settings.setKey('screenshot.frequency', value);
        }}
      />

      {/* æ–‡ä»¶å­˜å‚¨ä½ç½® */}
      <div className="setting-item">
        <label>å­˜å‚¨ä½ç½®</label>
        <button
          onClick={async () => {
            const path = await openFileDialog();
            settings.setKey('screenshot.storagePath', path);
          }}
          className="file-path-btn"
        >
          é€‰æ‹©æ–‡ä»¶å¤¹
        </button>
      </div>

      {/* å†…å­˜ä¸Šé™è®¾ç½® */}
      <div className="setting-item">
        <label>è‡ªåŠ¨åˆ é™¤ä¸Šé™</label>
        <input
          type="number"
          value={settings.get().screenshot.maxSize}
          onChange={(e) => {
            settings.setKey('screenshot.maxSize', Number(e.target.value));
          }}
          className="number-input"
        />
        <span className="unit">MB</span>
      </div>
    </div>
  );
}
```

---

## ğŸ“‹ å³ä¾§ä¸»å†…å®¹åŒº

### MemoryContent ç»„ä»¶

```typescript
// components/memory/MemoryContent.tsx
import { useStore } from '@nanostores/react';
import { selectedMemory } from '@/stores/memoryStore';
import { MemoryCard } from '@/components/MemoryCard';
import { LongTermSummary } from './LongTermSummary';

export function MemoryContent() {
  const memory = useStore(selectedMemory);
  const viewMode = useStore(memoryViewMode); // 'short' | 'long'

  if (!memory && viewMode === 'short') {
    return (
      <div className="content-empty">
        <p className="empty-message">
          æƒ³æ‰¾å“ªæ®µè®°å¿†ï¼Œæˆ‘éƒ½è®°ç€å‘¢éšä¾¿é—®
        </p>
      </div>
    );
  }

  return (
    <div className="content-area">
      {viewMode === 'short' && memory && (
        <MemoryCard memory={memory} />
      )}

      {viewMode === 'long' && (
        <LongTermSummary />
      )}
    </div>
  );
}
```

### çŸ­æœŸè®°å¿†å¡ç‰‡

```typescript
// components/MemoryCard/MemoryCard.tsx
interface MemoryCardProps {
  memory: ShortTermMemory;
}

export function MemoryCard({ memory }: MemoryCardProps) {
  return (
    <div className="memory-card">
      {/* æ ‡é¢˜ */}
      <header className="card-header">
        <h2 className="card-title">{memory.title}</h2>
        <span className="card-time">{memory.timeRange}</span>
      </header>

      {/* æ­£æ–‡: æ—¶é—´çº¿ + å›¾ç‰‡ç´¢å¼• + åˆ†ææ€»ç»“ */}
      <main className="card-content">
        <div className="timeline">
          {memory.screenshots.map((screenshot, index) => (
            <div key={screenshot.id} className="timeline-item">
              <div className="timeline-time">
                {formatTime(screenshot.timestamp)}
              </div>
              <div className="timeline-content">
                <img
                  src={screenshot.thumbnailPath}
                  alt={`Screenshot ${index + 1}`}
                  className="screenshot-thumb"
                  onClick={() => openImagePreview(screenshot.path)}
                />
                <p className="screenshot-analysis">
                  {screenshot.analysis}
                </p>
              </div>
            </div>
          ))}
        </div>
      </main>

      {/* ç»“å°¾: äº‹é¡¹å»ºè®®ä¸åˆ†æ */}
      <footer className="card-footer">
        <h3 className="footer-title">ğŸ’¡ å»ºè®®ä¸åˆ†æ</h3>
        <p className="footer-content">{memory.suggestion}</p>
      </footer>
    </div>
  );
}
```

### é•¿æœŸè®°å¿†æ€»ç»“

```typescript
// components/memory/LongTermSummary.tsx
import { useStore } from '@nanostores/react';
import { longTermSummary } from '@/stores/memoryStore';

export function LongTermSummary() {
  const summary = useStore(longTermSummary);

  return (
    <div className="long-term-summary">
      {/* æ ‡é¢˜ */}
      <header className="summary-header">
        <h2 className="summary-title">
          {formatDateRange(summary.dateRange)} äº‹é¡¹æ€»ç»“
        </h2>
      </header>

      {/* ä¸»è¦äº‹é¡¹æ¦‚è§ˆ */}
      <main className="summary-content">
        <div className="summary-text">
          {summary.summary}
        </div>

        <div className="events-list">
          <h3 className="events-title">ä¸»è¦äº‹é¡¹</h3>
          {summary.events.map((event) => (
            <div key={event.id} className="event-item">
              <div className="event-date">{formatDate(event.date)}</div>
              <div className="event-title">{event.title}</div>
              <div className="event-description">{event.description}</div>
            </div>
          ))}
        </div>
      </main>
    </div>
  );
}
```

---

## ğŸ”— çŠ¶æ€ç®¡ç†

### Nanostores å®šä¹‰

```typescript
// stores/memoryStore.ts
import { atom, map } from 'nanostores';

// å…¨å±€è®°å¿†å¼€å…³
export const memoryEnabled = atom<boolean>(true);

// çŸ­æœŸè®°å¿†åˆ—è¡¨
export const shortTermMemories = map<{
  date: string;
  items: ShortTermMemory[];
}>({
  date: new Date().toISOString(),
  items: []
});

// é€‰ä¸­çš„è®°å¿†é¡¹
export const selectedMemory = atom<ShortTermMemory | null>(null);

// é•¿æœŸè®°å¿†æ€»ç»“
export const longTermSummary = map<{
  dateRange: [string, string];
  summary: string;
  events: Event[];
}>({
  dateRange: ['', ''],
  summary: '',
  events: []
});

// è§†å›¾æ¨¡å¼
export const memoryViewMode = atom<'short' | 'long'>('short');
```

---

## ğŸ“± å“åº”å¼è®¾è®¡

```css
/* ç§»åŠ¨ç«¯é€‚é… */
@media (max-width: 768px) {
  .memory-page {
    flex-direction: column;
  }

  .memory-sidebar {
    width: 100%;
    border-right: none;
    border-bottom: 1px solid #e5e7eb;
    max-height: 40vh;
  }

  .memory-content {
    flex: 1;
  }
}
```

---

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

```typescript
// pages/memory.test.tsx
import { render, screen, fireEvent } from '@testing-library/react';
import MemoryPage from './memory.astro';

describe('Memory Page', () => {
  it('renders sidebar and main content', () => {
    render(<MemoryPage />);

    expect(screen.getByText('è®°å¿†åŠŸèƒ½')).toBeInTheDocument();
    expect(screen.getByPlaceholderText(/æƒ³æ‰¾å“ªæ®µè®°å¿†/)).toBeInTheDocument();
  });

  it('selects a memory and displays it', async () => {
    render(<MemoryPage />);

    const memoryItem = screen.getByText('å›¢é˜Ÿæ™¨ä¼š');
    fireEvent.click(memoryItem);

    expect(screen.getByText(/09:00-10:00/)).toBeInTheDocument();
  });
});
```

---

## ğŸ“ å¾…å®ç°åŠŸèƒ½

- [ ] æ—¥æœŸèŒƒå›´é€‰æ‹©å¼¹çª—
- [ ] é•¿æœŸè®°å¿†åˆ†æç¡®è®¤å¯¹è¯æ¡†
- [ ] è®°å¿†å¯¼å‡ºåŠŸèƒ½ï¼ˆPDF/JSONï¼‰
- [ ] è®°å¿†åˆ é™¤å’Œç¼–è¾‘
- [ ] æ ‡ç­¾ç­›é€‰åŠŸèƒ½
- [ ] å…¨æ–‡æœç´¢
- [ ] æ—¶é—´çº¿å¯è§†åŒ–å›¾è¡¨

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [MemoryList ç»„ä»¶](../components/MemoryList.md)
- [MemoryCard ç»„ä»¶](../components/MemoryCard.md)
- [DatePicker ç»„ä»¶](../components/DatePicker.md)
- [FloatingInput ç»„ä»¶](../components/FloatingInput.md)

---

**é¡µé¢ç»´æŠ¤è€…**: å‰ç«¯å›¢é˜Ÿ
**æœ€åæ›´æ–°**: 2026-02-04
