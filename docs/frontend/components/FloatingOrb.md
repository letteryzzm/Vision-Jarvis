# FloatingOrb ç»„ä»¶

> **ç»„ä»¶åç§°**: FloatingOrb (æ‚¬æµ®çƒ)
> **çŠ¶æ€**: âœ… å·²å®Œæˆ
> **æœ€åæ›´æ–°**: 2026-02-04

---

## ğŸ“‹ æ¦‚è¿°

FloatingOrb æ˜¯ Vision-Jarvis çš„æ ¸å¿ƒå…¥å£ç»„ä»¶ï¼Œä»¥**åœ†å½¢æ‚¬æµ®çƒ**çš„å½¢å¼å¸¸é©»æ¡Œé¢ï¼Œæ”¯æŒä¸‰ç§äº¤äº’çŠ¶æ€ï¼š
1. **Idle** - é»˜è®¤æ€ï¼ˆåœ†å½¢æ‚¬æµ®çƒï¼‰
2. **Header** - æ‚¬åœæ€ï¼ˆå±•å¼€å¿«æ·æ“ä½œï¼‰
3. **Asker** - ç‚¹å‡»æ€ï¼ˆå±•å¼€é—®ç­”ç•Œé¢ï¼‰

---

## ğŸ¨ UI è®¾è®¡

### è§†è§‰è§„èŒƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          FloatingOrb ä¸‰æ€è®¾è®¡              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Idle æ€ï¼ˆé»˜è®¤ï¼‰
   â”Œâ”€â”€â”€â”€â”
   â”‚ â—  â”‚  40x40px åœ†å½¢
   â””â”€â”€â”€â”€â”˜
   - èƒŒæ™¯: rgba(59, 130, 246, 0.8)
   - é˜´å½±: 0 4px 12px rgba(0,0,0,0.15)
   - ä½ç½®: å±å¹•å³ä¾§ä¸­å¤®
   - å¯æ‹–åŠ¨

2. Header æ€ï¼ˆé¼ æ ‡æ‚¬åœï¼‰
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ğŸ§  [å…¨å±€è®°å¿†: ON] ğŸ“‹ è®°å¿† âš™ï¸ è®¾ç½® â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   - å®½åº¦: 300px
   - é«˜åº¦: 50px
   - åŠ¨ç”»: slideInFromRight (300ms)
   - èƒŒæ™¯: linear-gradient(135deg, #667eea, #764ba2)

3. Asker æ€ï¼ˆç‚¹å‡»ï¼‰
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ğŸ¤– é—®æˆ‘ä»»ä½•è®°å¿†ç›¸å…³é—®é¢˜...     â”‚
   â”‚                               â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
   â”‚ â”‚ æœç´¢æ¡†                   â”‚   â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
   â”‚                               â”‚
   â”‚ å†å²å¯¹è¯:                      â”‚
   â”‚ Q: ä¸Šåˆåšäº†ä»€ä¹ˆ?               â”‚
   â”‚ A: æ‚¨ä¸Šåˆä¸»è¦è¿›è¡Œäº†...         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   - å®½åº¦: 400px
   - é«˜åº¦: 500px
   - åŠ¨ç”»: slideInFromBottom (400ms)
```

---

## ğŸ”§ ç»„ä»¶ API

### Props

```typescript
interface FloatingOrbProps {
  /** åˆå§‹ä½ç½® */
  initialPosition?: { x: number; y: number };

  /** æ˜¯å¦å¯æ‹–åŠ¨ */
  draggable?: boolean;

  /** é»˜è®¤çŠ¶æ€ */
  defaultState?: 'idle' | 'header' | 'asker';

  /** çŠ¶æ€æ”¹å˜å›è°ƒ */
  onStateChange?: (state: 'idle' | 'header' | 'asker') => void;

  /** è‡ªå®šä¹‰ç±»å */
  className?: string;
}
```

### é»˜è®¤å€¼

```typescript
const defaultProps: FloatingOrbProps = {
  initialPosition: { x: window.innerWidth - 60, y: window.innerHeight / 2 },
  draggable: true,
  defaultState: 'idle',
  onStateChange: undefined,
  className: ''
};
```

---

## ğŸ’» ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ç”¨æ³•

```typescript
// src/pages/index.astro
---
import Layout from '@/layouts/Layout.astro';
import FloatingOrb from '@/components/FloatingOrb';
---

<Layout title="Vision-Jarvis">
  <FloatingOrb client:load />
</Layout>
```

### è‡ªå®šä¹‰åˆå§‹ä½ç½®

```typescript
<FloatingOrb
  client:load
  initialPosition={{ x: 100, y: 200 }}
  draggable={true}
/>
```

### ç›‘å¬çŠ¶æ€å˜åŒ–

```typescript
<FloatingOrb
  client:load
  onStateChange={(state) => {
    console.log('FloatingOrb state changed to:', state);
  }}
/>
```

---

## ğŸ—ï¸ å†…éƒ¨å®ç°

### çŠ¶æ€ç®¡ç†

```typescript
// components/FloatingOrb/FloatingOrb.tsx
import { useState, useRef } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Header } from './Header';
import { Asker } from './Asker';

type FloatingState = 'idle' | 'header' | 'asker';

export function FloatingOrb({
  initialPosition = { x: window.innerWidth - 60, y: window.innerHeight / 2 },
  draggable = true,
  defaultState = 'idle',
  onStateChange
}: FloatingOrbProps) {
  const [state, setState] = useState<FloatingState>(defaultState);
  const [position, setPosition] = useState(initialPosition);
  const isDragging = useRef(false);

  // çŠ¶æ€è½¬æ¢é€»è¾‘
  const handleMouseEnter = () => {
    if (state === 'idle') {
      setState('header');
      onStateChange?.('header');
    }
  };

  const handleMouseLeave = () => {
    if (state === 'header' && !isDragging.current) {
      setState('idle');
      onStateChange?.('idle');
    }
  };

  const handleClick = () => {
    if (state !== 'asker') {
      setState('asker');
      onStateChange?.('asker');
    }
  };

  const handleClickOutside = () => {
    if (state === 'asker') {
      setState('idle');
      onStateChange?.('idle');
    }
  };

  // æ‹–åŠ¨é€»è¾‘
  const handleDragEnd = (event: any, info: any) => {
    setPosition({
      x: position.x + info.offset.x,
      y: position.y + info.offset.y
    });
    isDragging.current = false;
  };

  const handleDragStart = () => {
    isDragging.current = true;
  };

  return (
    <motion.div
      className="floating-orb-container"
      style={{
        position: 'fixed',
        left: position.x,
        top: position.y,
        zIndex: 9999
      }}
      drag={draggable}
      dragMomentum={false}
      onDragStart={handleDragStart}
      onDragEnd={handleDragEnd}
      onMouseEnter={handleMouseEnter}
      onMouseLeave={handleMouseLeave}
      onClick={handleClick}
    >
      <AnimatePresence mode="wait">
        {state === 'idle' && <IdleOrb key="idle" />}
        {state === 'header' && <Header key="header" />}
        {state === 'asker' && <Asker key="asker" onClose={handleClickOutside} />}
      </AnimatePresence>
    </motion.div>
  );
}
```

### å­ç»„ä»¶: IdleOrb (é»˜è®¤æ€)

```typescript
// components/FloatingOrb/IdleOrb.tsx
import { motion } from 'framer-motion';

export function IdleOrb() {
  return (
    <motion.div
      className="idle-orb"
      initial={{ scale: 0.8, opacity: 0 }}
      animate={{ scale: 1, opacity: 1 }}
      exit={{ scale: 0.8, opacity: 0 }}
      transition={{ duration: 0.2 }}
      style={{
        width: '40px',
        height: '40px',
        borderRadius: '50%',
        background: 'rgba(59, 130, 246, 0.8)',
        boxShadow: '0 4px 12px rgba(0, 0, 0, 0.15)',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        cursor: 'pointer'
      }}
    >
      <span className="text-white text-xl">ğŸ§ </span>
    </motion.div>
  );
}
```

---

## ğŸ¬ åŠ¨ç”»æ•ˆæœ

### çŠ¶æ€è½¬æ¢åŠ¨ç”»

```typescript
const animations = {
  idle: {
    initial: { scale: 0.8, opacity: 0 },
    animate: { scale: 1, opacity: 1 },
    exit: { scale: 0.8, opacity: 0 },
    transition: { duration: 0.2 }
  },

  header: {
    initial: { x: 100, opacity: 0 },
    animate: { x: 0, opacity: 1 },
    exit: { x: 100, opacity: 0 },
    transition: { duration: 0.3, ease: 'easeOut' }
  },

  asker: {
    initial: { y: 100, opacity: 0 },
    animate: { y: 0, opacity: 1 },
    exit: { y: 100, opacity: 0 },
    transition: { duration: 0.4, ease: 'easeOut' }
  }
};
```

### æ‹–åŠ¨åé¦ˆ

```typescript
// æ‹–åŠ¨æ—¶æ·»åŠ è§†è§‰åé¦ˆ
<motion.div
  drag
  whileDrag={{
    scale: 1.1,
    boxShadow: '0 8px 24px rgba(0, 0, 0, 0.3)'
  }}
  dragElastic={0.1}
  dragConstraints={{
    left: 0,
    right: window.innerWidth - 40,
    top: 0,
    bottom: window.innerHeight - 40
  }}
>
```

---

## ğŸ“± å“åº”å¼è®¾è®¡

```typescript
// æ ¹æ®å±å¹•å°ºå¯¸è°ƒæ•´å¤§å°
const getOrbSize = () => {
  const width = window.innerWidth;
  if (width < 768) return { idle: 32, header: 250, asker: 320 };
  if (width < 1024) return { idle: 36, header: 280, asker: 360 };
  return { idle: 40, header: 300, asker: 400 };
};
```

---

## â™¿ å¯è®¿é—®æ€§

### é”®ç›˜å¯¼èˆª

```typescript
// æ”¯æŒ ESC é”®å…³é—­ Asker
useEffect(() => {
  const handleKeyDown = (e: KeyboardEvent) => {
    if (e.key === 'Escape' && state === 'asker') {
      setState('idle');
    }
  };

  window.addEventListener('keydown', handleKeyDown);
  return () => window.removeEventListener('keydown', handleKeyDown);
}, [state]);
```

### ARIA æ ‡ç­¾

```typescript
<motion.div
  role="button"
  tabIndex={0}
  aria-label="Vision-Jarvis æ‚¬æµ®åŠ©æ‰‹"
  aria-expanded={state !== 'idle'}
  aria-haspopup="dialog"
>
```

---

## ğŸ§ª æµ‹è¯•

### å•å…ƒæµ‹è¯•

```typescript
// components/FloatingOrb/FloatingOrb.test.tsx
import { render, screen, fireEvent } from '@testing-library/react';
import { FloatingOrb } from './FloatingOrb';

describe('FloatingOrb', () => {
  it('renders in idle state by default', () => {
    render(<FloatingOrb />);
    expect(screen.getByRole('button')).toBeInTheDocument();
  });

  it('switches to header state on mouse enter', () => {
    render(<FloatingOrb />);
    const orb = screen.getByRole('button');

    fireEvent.mouseEnter(orb);
    expect(screen.getByText(/å…¨å±€è®°å¿†/)).toBeInTheDocument();
  });

  it('switches to asker state on click', () => {
    render(<FloatingOrb />);
    const orb = screen.getByRole('button');

    fireEvent.click(orb);
    expect(screen.getByPlaceholderText(/é—®æˆ‘ä»»ä½•/)).toBeInTheDocument();
  });

  it('calls onStateChange callback', () => {
    const handleStateChange = vi.fn();
    render(<FloatingOrb onStateChange={handleStateChange} />);

    fireEvent.mouseEnter(screen.getByRole('button'));
    expect(handleStateChange).toHaveBeenCalledWith('header');
  });
});
```

---

## ğŸ› å·²çŸ¥é—®é¢˜

| é—®é¢˜ | ä¼˜å…ˆçº§ | çŠ¶æ€ | è®¡åˆ’ä¿®å¤ç‰ˆæœ¬ |
|------|-------|------|-------------|
| å¤šæ˜¾ç¤ºå™¨æ‹–åŠ¨ä½ç½®è®¡ç®—é”™è¯¯ | ğŸŸ¡ ä¸­ | å·²çŸ¥ | v1.1 |
| æ‹–åŠ¨æ—¶é¼ æ ‡æŒ‡é’ˆåç§» | ğŸŸ¢ ä½ | å·²çŸ¥ | v1.2 |

---

## ğŸ“ å¾…ä¼˜åŒ–

- [ ] æ·»åŠ æ‹–åŠ¨è¾¹ç•Œæ£€æµ‹ï¼ˆé˜²æ­¢æ‹–å‡ºå±å¹•ï¼‰
- [ ] æ”¯æŒè´´è¾¹æ”¶èµ·åŠŸèƒ½
- [ ] æ·»åŠ åŒå‡»å¿«é€Ÿåˆ‡æ¢çŠ¶æ€
- [ ] æ”¯æŒè‡ªå®šä¹‰ä¸»é¢˜é¢œè‰²
- [ ] æ·»åŠ æ‚¬æµ®çƒåŠ¨æ•ˆï¼ˆå‘¼å¸ç¯ã€è„‰å†²ç­‰ï¼‰

---

## ğŸ”— ç›¸å…³ç»„ä»¶

- [Header](Header.md) - Header å±•å¼€æ¨¡å¼
- [Asker](Asker.md) - é—®ç­”å¯¹è¯ç»„ä»¶

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Framer Motion Drag API](https://www.framer.com/motion/gestures/#drag)
- [React useRef Hook](https://react.dev/reference/react/useRef)
- [AnimatePresence](https://www.framer.com/motion/animate-presence/)

---

**ç»„ä»¶ç»´æŠ¤è€…**: å‰ç«¯å›¢é˜Ÿ
**æµ‹è¯•è¦†ç›–ç‡**: 85%
**æœ€åæ›´æ–°**: 2026-02-04
