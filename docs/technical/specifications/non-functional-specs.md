# Vision-Jarvis 非功能需求

> **文档类型**: 非功能需求规范 (Non-Functional Requirements)
> **创建日期**: 2026-02-01
> **版本**: v1.0
> **优先级**: P1 (第四优先)

## ⚙️ 非功能需求概述

非功能需求定义了系统"如何做"而不是"做什么"，包括性能、安全、可用性、兼容性等方面的要求。

---

## 1. 性能需求

### 1.1 响应时间

| 功能 | 指标 | 目标值 | 测量方法 | 优先级 |
|------|------|--------|----------|--------|
| **截图捕获** | 单次耗时 | P95 < 500ms | 性能监控 | P0 |
| **AI 分析** | 单次耗时 | P95 < 10s | 性能监控 | P0 |
| **记忆生成** | 单次耗时 | P95 < 30s | 性能监控 | P1 |
| **API 响应** | 请求响应 | P95 < 200ms | APM 工具 | P0 |
| **数据库查询** | 查询响应 | P95 < 100ms | 数据库日志 | P1 |
| **UI 交互** | 点击响应 | < 100ms | 用户测试 | P0 |

### 1.2 吞吐量

| 功能 | 指标 | 目标值 | 测量方法 |
|------|------|--------|----------|
| **截图处理** | 处理能力 | 10 张/秒 | 压力测试 |
| **AI 分析** | 并发处理 | 5 张/秒 | 压力测试 |
| **API 并发** | 并发请求 | 100 req/s | 负载测试 |

### 1.3 资源占用

| 资源 | 指标 | 目标值 | 测量方法 | 说明 |
|------|------|--------|----------|------|
| **CPU** | 平均占用 | < 10% | 系统监控 | 后台运行时 |
| **CPU** | 峰值占用 | < 30% | 系统监控 | AI 分析时 |
| **内存** | 平均占用 | < 500MB | 系统监控 | 稳定运行 |
| **内存** | 峰值占用 | < 1GB | 系统监控 | 分析任务时 |
| **磁盘 I/O** | 读写速率 | < 50MB/s | 系统监控 | 截图存储时 |
| **网络** | 带宽占用 | < 1MB/s | 网络监控 | AI API 调用 |

### 1.4 存储需求

| 项目 | 指标 | 目标值 | 说明 |
|------|------|--------|------|
| **每日存储增长** | 增量 | < 500MB/天 | 默认配置（10 秒间隔） |
| **数据库大小** | 总量 | < 5GB/月 | 包含所有元数据 |
| **截图文件大小** | 单张 | < 5MB | 压缩后 |
| **总存储容量** | 限制 | 可配置 | 默认 10GB，超出自动清理 |

### 1.5 性能测试场景

**场景 1: 长时间运行测试**

```
条件:
- 连续运行 24 小时
- 默认配置（10 秒截图间隔）

预期:
- 内存占用保持稳定 (< 500MB)
- CPU 占用平均 < 10%
- 无内存泄漏
- 截图成功率 > 95%
```

**场景 2: 高负载测试**

```
条件:
- 5 秒截图间隔
- 同时启用 AI 分析
- 频繁生成记忆

预期:
- CPU 峰值 < 30%
- 内存峰值 < 1GB
- 所有功能正常响应
```

---

## 2. 可用性需求

### 2.1 系统可用性

| 指标 | 目标值 | 测量周期 | 说明 |
|------|--------|----------|------|
| **系统可用性** | 99.9% | 月度 | 月度停机时间 < 43 分钟 |
| **数据可靠性** | 99.99% | 月度 | 数据丢失率 < 0.01% |
| **故障恢复时间** | < 5 分钟 | 单次 | 从故障到恢复的时间 |

### 2.2 容错能力

| 场景 | 处理方式 | 恢复目标 |
|------|----------|----------|
| **截图失败** | 自动重试 3 次 | 99% 成功率 |
| **AI API 失败** | 自动重试 + 降级 | 队列保留，延迟处理 |
| **数据库异常** | 事务回滚 + 重试 | 数据完整性 100% |
| **磁盘空间不足** | 自动清理旧文件 | 提前预警 |
| **应用崩溃** | 自动重启 | < 10 秒恢复 |

### 2.3 数据备份

| 项目 | 策略 | 频率 | 保留期限 |
|------|------|------|----------|
| **数据库备份** | 全量备份 | 每日 | 30 天 |
| **截图备份** | 用户可选 | 手动/自动 | 用户自定义 |
| **配置备份** | 自动备份 | 配置变更时 | 永久 |

---

## 3. 安全需求

### 3.1 数据安全

| 安全项 | 要求 | 实现方式 | 优先级 |
|--------|------|----------|--------|
| **数据加密** | 截图文件加密 | AES-256 加密存储 | P1 |
| **传输加密** | API 通信加密 | HTTPS/TLS 1.3 | P0 |
| **权限控制** | 用户数据隔离 | 基于用户 ID 的访问控制 | P0 |
| **隐私保护** | 敏感信息脱敏 | 自动检测并模糊处理 | P0 |
| **密钥管理** | API 密钥安全 | 本地加密存储 | P0 |

### 3.2 访问控制

| 功能 | 权限要求 | 验证方式 |
|------|----------|----------|
| **屏幕录制** | macOS 系统权限 | 系统级权限检查 |
| **文件访问** | 沙盒权限 | Tauri 权限系统 |
| **网络访问** | API 密钥验证 | 密钥加密存储 |

### 3.3 数据隐私

**隐私保护措施**:

1. **本地优先**: 所有数据默认本地存储
2. **用户控制**: 用户可选择是否启用云同步
3. **敏感内容检测**: 自动检测并标记敏感信息
4. **隐私模式**: 支持暂时停止截图
5. **数据清理**: 支持一键清除所有数据

**不收集的数据**:

- ❌ 截图的具体内容（仅本地存储）
- ❌ OCR 的完整文本（仅存储摘要）
- ❌ 个人身份信息
- ❌ 银行卡、密码等敏感信息

---

## 4. 兼容性需求

### 4.1 平台兼容性

| 平台 | 版本要求 | 优先级 | 备注 |
|------|----------|--------|------|
| **macOS** | macOS 12+ (Monterey) | P0 | 主要支持平台 |
| **Windows** | Windows 10+ | P1 | 后续支持 |
| **Linux** | Ubuntu 20.04+ | P2 | 社区支持 |

### 4.2 硬件要求

| 组件 | 最低配置 | 推荐配置 |
|------|----------|----------|
| **CPU** | 双核 2.0GHz | 四核 2.5GHz+ |
| **内存** | 4GB RAM | 8GB RAM+ |
| **存储** | 10GB 可用空间 | 50GB+ SSD |
| **显示器** | 1280x720 | 1920x1080+ |

### 4.3 软件依赖

| 依赖 | 版本要求 | 用途 |
|------|----------|------|
| **Rust** | 2021 edition | 编译环境 |
| **Tauri** | 2.x | 应用框架 |
| **SQLite** | 3.x | 数据库 |
| **Node.js** | 18+ | 前端构建 |

---

## 5. 可维护性需求

### 5.1 代码质量

| 指标 | 目标值 | 工具 |
|------|--------|------|
| **代码覆盖率** | > 70% | cargo-tarpaulin |
| **Lint 通过率** | 100% | clippy |
| **文档覆盖率** | > 80% | rustdoc |
| **复杂度** | < 15 (Cyclomatic) | cargo-complexity |

### 5.2 日志和监控

| 类型 | 级别 | 保留期限 | 用途 |
|------|------|----------|------|
| **应用日志** | INFO/WARN/ERROR | 30 天 | 问题排查 |
| **性能日志** | DEBUG | 7 天 | 性能分析 |
| **错误日志** | ERROR | 90 天 | 错误追踪 |
| **审计日志** | INFO | 永久 | 安全审计 |

### 5.3 版本管理

| 项目 | 策略 | 说明 |
|------|------|------|
| **语义化版本** | MAJOR.MINOR.PATCH | 遵循 SemVer 2.0 |
| **变更日志** | CHANGELOG.md | 每次发布更新 |
| **数据库迁移** | 版本化迁移脚本 | Diesel migrations |

---

## 6. 可扩展性需求

### 6.1 横向扩展

| 功能 | 扩展方式 | 说明 |
|------|----------|------|
| **AI 模型** | 插件化设计 | 支持切换不同 AI 提供商 |
| **存储后端** | 抽象接口 | 支持多种存储方案 |
| **通知渠道** | 事件驱动 | 支持多种通知方式 |

### 6.2 配置灵活性

| 配置项 | 可配置范围 | 默认值 |
|--------|-----------|--------|
| **截图间隔** | 5-300 秒 | 10 秒 |
| **存储容量** | 1-100 GB | 10 GB |
| **AI 模型** | Claude/GPT/本地 | Claude |
| **日志级别** | ERROR/WARN/INFO/DEBUG | INFO |

---

## 7. 用户体验需求

### 7.1 易用性

| 指标 | 目标值 | 测量方法 |
|------|--------|----------|
| **首次使用时间** | < 5 分钟 | 用户测试 |
| **学习曲线** | 1 小时掌握基本功能 | 用户访谈 |
| **错误恢复** | 用户能自行解决 80% 的问题 | 支持工单统计 |

### 7.2 可访问性

| 功能 | 要求 | 优先级 |
|------|------|--------|
| **键盘导航** | 所有功能支持键盘操作 | P1 |
| **快捷键** | 常用功能提供快捷键 | P1 |
| **高对比度** | 支持高对比度主题 | P2 |

### 7.3 本地化

| 语言 | 支持范围 | 优先级 |
|------|----------|--------|
| **中文** | 完整支持 | P0 |
| **英文** | 完整支持 | P0 |
| **日语** | 后续支持 | P2 |

---

## 8. 测试需求

### 8.1 测试覆盖率

| 测试类型 | 覆盖率目标 | 工具 |
|----------|-----------|------|
| **单元测试** | > 70% | cargo test |
| **集成测试** | > 50% | cargo test |
| **端到端测试** | 核心流程 100% | 手动/自动化 |

### 8.2 性能测试

| 测试场景 | 测试频率 | 工具 |
|----------|----------|------|
| **压力测试** | 每次发布前 | 自定义脚本 |
| **长时间运行** | 每周 | 自动化测试 |
| **内存泄漏** | 每次发���前 | valgrind/heaptrack |

---

## 9. 部署和运维

### 9.1 部署方式

| 平台 | 部署方式 | 更新机制 |
|------|----------|----------|
| **macOS** | DMG 安装包 | 应用内更新 |
| **Windows** | MSI 安装包 | 应用内更新 |
| **Linux** | AppImage / Snap | 应用内更新 |

### 9.2 监控告警

| 监控项 | 阈值 | 告警方式 |
|--------|------|----------|
| **CPU 占用** | > 50% 持续 5 分钟 | 日志记录 |
| **内存占用** | > 1.5GB | 日志记录 |
| **磁盘空间** | < 1GB | 用户通知 |
| **错误率** | > 5% | 日志记录 |

---

## 10. 合规性要求

### 10.1 数据合规

| 法规 | 要求 | 实现方式 |
|------|------|----------|
| **GDPR** | 数据可删除 | 提供数据清理功能 |
| **CCPA** | 数据透明性 | 明确数据收集说明 |
| **本地法规** | 数据本地化 | 默认本地存储 |

### 10.2 开源许可

| 组件 | 许可证 | 兼容性 |
|------|--------|--------|
| **Vision-Jarvis** | MIT / Apache 2.0 | 商业友好 |
| **依赖库** | 兼容许可证 | 需审查 |

---

## 相关文档

- [功能规格说明](../technical/functional-specifications.md) - 功能详细设计
- [验收标准](./acceptance-criteria.md) - 功能验收标准
- [数据埋点方案](./analytics-tracking.md) - 埋点和指标定义
- [后端架构设计](../technical/backend-architecture.md) - 技术架构
