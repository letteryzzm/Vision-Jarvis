---
import Layout from '../layouts/Layout.astro';
import FloatingOrb from '../components/FloatingOrb/FloatingOrb.astro';
import HeaderExpanded from '../components/Header/HeaderExpanded.astro';
import AskerExpanded from '../components/Asker/AskerExpanded.astro';
---

<Layout>
	<main id="app" class="min-h-screen bg-app relative">
		<!-- Floating Orb -->
		<FloatingOrb />

		<!-- Header Expanded (hidden by default) -->
		<HeaderExpanded />

		<!-- Asker Expanded (hidden by default) -->
		<AskerExpanded />

		<!-- Welcome Content -->
		<div class="flex items-center justify-center h-screen">
			<div class="text-center max-w-2xl px-8">
				<h1 class="text-6xl font-bold mb-6 bg-gradient-to-r from-[#00D4FF] to-[#7B2FFF] bg-clip-text text-transparent">
					Vision-Jarvis
				</h1>
				<p class="text-xl text-secondary mb-8">
					AI-powered Screen Monitoring & Memory Assistant
				</p>
				<p class="text-muted text-sm mb-12">
					ç‚¹å‡»å³ä¸‹è§’æ‚¬æµ®çƒå¼€å§‹ä½¿ç”¨
				</p>

				<div class="grid grid-cols-2 gap-4 text-left">
					<div class="p-6 bg-card rounded-[20px] border border-primary hover:border-glow transition-colors">
						<div class="text-4xl mb-3">ğŸ“¸</div>
						<h3 class="font-semibold text-lg mb-2 text-primary">Screenshots</h3>
						<p class="text-sm text-muted">æ™ºèƒ½æ•è·å’Œåˆ†æå±å¹•æ´»åŠ¨</p>
					</div>
					<div class="p-6 bg-card rounded-[20px] border border-primary hover:border-glow transition-colors">
						<div class="text-4xl mb-3">ğŸ§ </div>
						<h3 class="font-semibold text-lg mb-2 text-primary">Memories</h3>
						<p class="text-sm text-muted">ç”Ÿæˆæ™ºèƒ½çš„æ—¥ç¨‹æ‘˜è¦</p>
					</div>
					<div class="p-6 bg-card rounded-[20px] border border-primary hover:border-glow transition-colors">
						<div class="text-4xl mb-3">ğŸ””</div>
						<h3 class="font-semibold text-lg mb-2 text-primary">Notifications</h3>
						<p class="text-sm text-muted">æ™ºèƒ½æé†’ä¼‘æ¯å’Œä¸“æ³¨</p>
					</div>
					<div class="p-6 bg-card rounded-[20px] border border-primary hover:border-glow transition-colors">
						<div class="text-4xl mb-3">âš™ï¸</div>
						<h3 class="font-semibold text-lg mb-2 text-primary">Settings</h3>
						<p class="text-sm text-muted">ä¸ªæ€§åŒ–å®šåˆ¶æ‚¨çš„ä½“éªŒ</p>
					</div>
				</div>
			</div>
		</div>
	</main>

	<script>
		// çŠ¶æ€ç®¡ç†
		let isHeaderVisible = false;
		let isAskerVisible = false;

		const floatingOrb = document.getElementById('floating-orb');
		const headerExpanded = document.getElementById('header-expanded');
		const askerExpanded = document.getElementById('asker-expanded');

		// åˆ‡æ¢åŠ©æ‰‹æ˜¾ç¤º
		window.addEventListener('toggle-assistant', () => {
			if (!isAskerVisible) {
				// æ˜¾ç¤º Asker
				askerExpanded?.classList.remove('hidden');
				setTimeout(() => {
					askerExpanded?.classList.remove('opacity-0');
				}, 10);

				// éšè—æ‚¬æµ®çƒ
				floatingOrb?.classList.add('opacity-0', 'scale-0');

				// æ˜¾ç¤º Header
				if (!isHeaderVisible) {
					headerExpanded?.classList.remove('hidden');
					setTimeout(() => {
						headerExpanded?.classList.remove('opacity-0');
					}, 10);
					isHeaderVisible = true;
				}

				isAskerVisible = true;
			} else {
				// éšè— Asker
				askerExpanded?.classList.add('opacity-0');
				setTimeout(() => {
					askerExpanded?.classList.add('hidden');
				}, 300);

				// æ˜¾ç¤ºæ‚¬æµ®çƒ
				floatingOrb?.classList.remove('opacity-0', 'scale-0');

				isAskerVisible = false;
			}
		});

		// å…³é—­åŠ©æ‰‹
		window.addEventListener('close-assistant', () => {
			// éšè— Asker
			askerExpanded?.classList.add('opacity-0');
			setTimeout(() => {
				askerExpanded?.classList.add('hidden');
			}, 300);

			// æ˜¾ç¤ºæ‚¬æµ®çƒ
			floatingOrb?.classList.remove('opacity-0', 'scale-0');

			isAskerVisible = false;
		});

		// ç‚¹å‡»å¤–éƒ¨å…³é—­é¢æ¿
		document.addEventListener('click', (e) => {
			const target = e.target as HTMLElement;

			if (isAskerVisible &&
			    !askerExpanded?.contains(target) &&
			    !floatingOrb?.contains(target) &&
			    !headerExpanded?.contains(target)) {
				window.dispatchEvent(new CustomEvent('close-assistant'));
			}
		});
	</script>
</Layout>
